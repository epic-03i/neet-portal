<!DOCTYPE html>
<html>
<head>
    <title>NEET Admin Panel</title>
    <style>
        /* ========== ALL CSS IN ONE FILE ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 { 
            color: #2d3748; 
            margin-bottom: 20px; 
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        /* Tabs */
        .tabs { 
            display: flex; 
            flex-wrap: wrap;
            margin-bottom: 30px; 
            border-bottom: 2px solid #e2e8f0;
        }
        .tab { 
            padding: 12px 25px; 
            cursor: pointer; 
            background: #f7fafc; 
            border: 1px solid #e2e8f0;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab:hover { background: #edf2f7; }
        .tab.active { 
            background: #667eea; 
            color: white; 
            border-color: #667eea;
            position: relative;
            top: 1px;
        }
        
        /* Tab Content */
        .content { 
            display: none; 
            padding: 25px; 
            background: #f8f9fa; 
            border-radius: 0 8px 8px 8px;
            border: 1px solid #e2e8f0;
            border-top: none;
        }
        .content.active { display: block; }
        
        /* Day Boxes */
        .day-boxes { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px; 
            margin: 20px 0;
        }
        .day-box { 
            height: 70px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
            border: 3px solid;
        }
        .day-box.empty { 
            background: #e2e8f0; 
            border-color: #cbd5e0;
            color: #718096;
        }
        .day-box.partial { 
            background: #fff3cd; 
            border-color: #ffc107;
            color: #856404;
        }
        .day-box.full { 
            background: #d4edda; 
            border-color: #28a745;
            color: #155724;
        }
        .day-box:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .day-box.selected { 
            background: #667eea; 
            border-color: #5a67d8;
            color: white;
            transform: scale(1.05);
        }
        
        /* Forms */
        input, select, textarea {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 16px;
            margin: 8px 0;
            width: 100%;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600;
            color: #4a5568;
        }
        
        /* Buttons */
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        button:hover { 
            background: #5a67d8; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button.green { background: #48bb78; }
        button.green:hover { background: #38a169; }
        button.red { background: #f56565; }
        button.red:hover { background: #e53e3e; }
        button.yellow { background: #ecc94b; color: #744210; }
        button.yellow:hover { background: #d69e2e; }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px 15px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) { background: #f7fafc; }
        tr:hover { background: #edf2f7; }
        
        /* JSON Editor */
        .json-editor {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 300px;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 6px;
            padding: 15px;
        }
        
        /* Status Indicators */
        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pending { background: #ecc94b; }
        .status-complete { background: #48bb78; }
        .status-empty { background: #cbd5e0; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .tab { padding: 10px 15px; font-size: 14px; }
            .day-box { height: 60px; font-size: 16px; }
            .day-boxes { grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã NEET Exam Portal - Admin Panel</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('upload')">üì§ Upload Questions</div>
            <div class="tab" onclick="showTab('schedule')">üìÖ 82-Day Schedule</div>
            <div class="tab" onclick="showTab('users')">üë• Student Progress</div>
            <div class="tab" onclick="showTab('certificates')">üèÜ Certificates</div>
        </div>
        
        <!-- Tab 1: Upload Questions -->
        <div id="upload" class="content active">
            <h2>Upload Questions for Day</h2>
            
            <div class="form-group">
                <label>Select Day:</label>
                <select id="daySelect" onchange="loadDayQuestions(this.value)">
                    <option value="">-- Select Day (1-82) --</option>
                    <!-- Filled by JavaScript -->
                </select>
            </div>
            
            <div id="dayInfo" style="display: none; background: #e6f7ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <h3>Day <span id="selectedDay">1</span>: <span id="selectedTopic">Gaseous State (Easy)</span></h3>
                <p><strong>Subject:</strong> <span id="selectedSubject">Physical Chemistry</span></p>
                <p><strong>Status:</strong> <span id="selectedStatus">0/15 questions uploaded</span></p>
            </div>
            
            <h3>Method 1: Upload JSON (Fastest)</h3>
            <textarea id="jsonUpload" class="json-editor" placeholder='{
  "subject": "Chemistry",
  "chapter": "Gaseous State",
  "day": 1,
  "questions": [
    {
      "id": 1,
      "question": "For an ideal gas, which quantity depends only on temperature?",
      "options": {
        "A": "Pressure",
        "B": "Volume",
        "C": "Average kinetic energy",
        "D": "Density"
      },
      "answer": "C"
    }
  ]
}'></textarea>
            <button onclick="uploadJSON()" class="green">üì§ Upload JSON for Selected Day</button>
            
            <h3 style="margin-top: 40px;">Method 2: Add Single Question</h3>
            <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #cbd5e0;">
                <div class="form-group">
                    <label>Question Text:</label>
                    <textarea id="questionText" placeholder="Enter your question here..." rows="3"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Option A:</label>
                        <input type="text" id="optA" placeholder="Option A">
                    </div>
                    <div class="form-group">
                        <label>Option B:</label>
                        <input type="text" id="optB" placeholder="Option B">
                    </div>
                    <div class="form-group">
                        <label>Option C:</label>
                        <input type="text" id="optC" placeholder="Option C">
                    </div>
                    <div class="form-group">
                        <label>Option D:</label>
                        <input type="text" id="optD" placeholder="Option D">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Correct Answer:</label>
                    <select id="correctOption">
                        <option value="">Select correct option</option>
                        <option value="A">Option A</option>
                        <option value="B">Option B</option>
                        <option value="C">Option C</option>
                        <option value="D">Option D</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Explanation (Optional):</label>
                    <textarea id="explanation" placeholder="Add explanation here..." rows="2"></textarea>
                </div>
                
                <button onclick="addSingleQuestion()" class="green">‚ûï Add This Question</button>
            </div>
            
            <h3 style="margin-top: 40px;">Current Questions for Day <span id="currentDayDisplay">1</span></h3>
            <div id="questionsList" style="margin-top: 20px;">
                <!-- Questions will appear here -->
            </div>
        </div>
        
        <!-- Tab 2: Schedule Manager -->
        <div id="schedule" class="content">
            <h2>82-Day NEET Preparation Schedule</h2>
            <p>Click any day to view/edit questions</p>
            
            <div class="day-boxes" id="dayBoxes">
                <!-- Day boxes will be generated here -->
            </div>
            
            <div id="dayDetails" style="display: none; margin-top: 30px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #e2e8f0;">
                <h3>Day <span id="detailDay">1</span> Details</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <p><strong>üìÖ Date:</strong> <span id="detailDate">Tuesday, February 10, 2026</span></p>
                        <p><strong>üìö Topic:</strong> <span id="detailTopic">Gaseous State (Easy)</span></p>
                        <p><strong>üß™ Subject:</strong> <span id="detailSubject">Physical Chemistry</span></p>
                    </div>
                    <div>
                        <p><strong>üìä Status:</strong> <span id="detailStatus">Pending</span></p>
                        <p><strong>‚ùì Questions:</strong> <span id="detailQuestions">0/15 uploaded</span></p>
                        <p><strong>üîÑ Last Updated:</strong> <span id="detailUpdated">Never</span></p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="goToDayEdit()" class="green">‚úèÔ∏è Edit This Day's Questions</button>
                    <button onclick="clearDayQuestions()" class="red">üóëÔ∏è Clear All Questions</button>
                </div>
            </div>
        </div>
        
        <!-- Tab 3: User Progress -->
        <div id="users" class="content">
            <h2>Student Progress Tracking</h2>
            
            <div style="margin: 20px 0;">
                <button onclick="loadAllUsers()" class="green">üîÑ Refresh Data</button>
                <button onclick="exportToCSV()" class="yellow">üìä Export to CSV</button>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Current Day</th>
                        <th>Progress</th>
                        <th>Avg Score</th>
                        <th>Last Active</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <!-- Tab 4: Certificates -->
        <div id="certificates" class="content">
            <h2>Generate Completion Certificate</h2>
            
            <div class="form-group">
                <label>Select Student:</label>
                <select id="certStudent" style="width: 300px;">
                    <option value="">-- Select Student --</option>
                </select>
            </div>
            
            <button onclick="generateCertificate()" class="green">üéì Generate Certificate</button>
            
            <div id="certificateContainer" style="display: none; margin-top: 40px;">
                <div style="border: 5px solid gold; padding: 40px; text-align: center; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                    <h1 style="color: #2d3748; font-size: 36px; margin-bottom: 20px;">üéì NEET Preparation Certificate</h1>
                    
                    <p style="font-size: 18px; color: #4a5568;">This is to certify that</p>
                    <h2 id="certName" style="color: #667eea; font-size: 32px; margin: 10px 0; padding: 10px; border-bottom: 2px solid #cbd5e0;">Student Name</h2>
                    
                    <p style="font-size: 16px; color: #718096; margin: 20px 0;">
                        has successfully completed the intensive 82-day NEET preparation program<br>
                        from <strong id="certStart">February 10, 2026</strong> to <strong id="certEnd">May 2, 2026</strong>
                    </p>
                    
                    <div style="background: #f7fafc; padding: 20px; border-radius: 10px; display: inline-block; margin: 20px 0;">
                        <p style="font-size: 14px; color: #4a5568;">Overall Performance</p>
                        <h3 id="certScore" style="color: #48bb78; font-size: 48px; margin: 10px 0;">92%</h3>
                    </div>
                    
                    <p style="color: #718096; margin-top: 30px;">
                        Certificate ID: <strong id="certID">NEET2026-ABC123</strong><br>
                        Issued on: <span id="certDate">May 3, 2026</span>
                    </p>
                    
                    <div style="margin-top: 30px;">
                        <button onclick="printCertificate()" class="green">üñ®Ô∏è Print Certificate</button>
                        <button onclick="downloadCertificate()" class="yellow">üì• Download as Image</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== ALL JAVASCRIPT IN ONE FILE ========== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyCgDgQ6LwB7qM6q7q7q7q7q7q7q7q7q7q7",
            authDomain: "neet-portal-demo.firebaseapp.com",
            databaseURL: "https://neet-portal-demo-default-rtdb.firebaseio.com",
            projectId: "neet-portal-demo",
            storageBucket: "neet-portal-demo.appspot.com",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abc123def456ghi789"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // ========== 82-DAY SCHEDULE DATA ==========
        const schedule = [
            // Day 1-82 data from your schedule
            {day:1, date:"Tuesday, February 10, 2026", topic:"Gaseous State (Easy)", subject:"Physical Chemistry"},
            {day:2, date:"Wednesday, February 11, 2026", topic:"Solutions (Medium)", subject:"Physical Chemistry"},
            {day:3, date:"Thursday, February 12, 2026", topic:"Chemical Kinetics (Medium)", subject:"Physical Chemistry"},
            {day:4, date:"Friday, February 13, 2026", topic:"Chemical Kinetics (Medium)", subject:"Physical Chemistry"},
            {day:5, date:"Saturday, February 14, 2026", topic:"Electrochemistry (Hard)", subject:"Physical Chemistry"},
            {day:6, date:"Sunday, February 15, 2026", topic:"Electrochemistry (Hard)", subject:"Physical Chemistry"},
            {day:7, date:"Monday, February 16, 2026", topic:"Thermodynamics (Hard)", subject:"Physical Chemistry"},
            {day:8, date:"Tuesday, February 17, 2026", topic:"Thermodynamics (Hard)", subject:"Physical Chemistry"},
            {day:9, date:"Wednesday, February 18, 2026", topic:"Physical Chem PYQs", subject:"Physical Chemistry"},
            {day:10, date:"Thursday, February 19, 2026", topic:"Physical Chem Revision", subject:"Physical Chemistry"},
            // ... Continue for all 82 days (truncated for space)
        ];
        
        // ========== GLOBAL VARIABLES ==========
        let currentSelectedDay = 1;
        
        // ========== INITIALIZE WHEN PAGE LOADS ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('NEET Admin Panel Loaded');
            initializePage();
        });
        
        function initializePage() {
            populateDaySelector();
            generateDayBoxes();
            loadAllUsers();
        }
        
        // ========== TAB FUNCTIONS ==========
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // ========== DAY SELECTOR FUNCTIONS ==========
        function populateDaySelector() {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '<option value="">-- Select Day (1-82) --</option>';
            
            schedule.forEach(day => {
                const option = document.createElement('option');
                option.value = day.day;
                option.textContent = `Day ${day.day}: ${day.topic}`;
                daySelect.appendChild(option);
            });
        }
        
        function generateDayBoxes() {
            const container = document.getElementById('dayBoxes');
            container.innerHTML = '';
            
            for (let i = 1; i <= 82; i++) {
                const dayBox = document.createElement('div');
                dayBox.className = 'day-box empty';
                dayBox.textContent = i;
                dayBox.onclick = () => selectDayBox(i);
                container.appendChild(dayBox);
            }
            
            // Load initial status
            updateAllDayBoxes();
        }
        
        function selectDayBox(dayNum) {
            currentSelectedDay = dayNum;
            
            // Update day selector
            document.getElementById('daySelect').value = dayNum;
            
            // Update UI
            const dayData = schedule.find(d => d.day === dayNum);
            if (dayData) {
                document.getElementById('selectedDay').textContent = dayNum;
                document.getElementById('selectedTopic').textContent = dayData.topic;
                document.getElementById('selectedSubject').textContent = dayData.subject;
                document.getElementById('dayInfo').style.display = 'block';
                
                // Load questions for this day
                loadDayQuestions(dayNum);
                
                // Update schedule tab details
                document.getElementById('detailDay').textContent = dayNum;
                document.getElementById('detailDate').textContent = dayData.date;
                document.getElementById('detailTopic').textContent = dayData.topic;
                document.getElementById('detailSubject').textContent = dayData.subject;
                document.getElementById('dayDetails').style.display = 'block';
                
                // Update day boxes selection
                document.querySelectorAll('.day-box').forEach(box => {
                    box.classList.remove('selected');
                });
                document.querySelectorAll('.day-box')[dayNum-1].classList.add('selected');
                
                // Switch to upload tab if not already
                showTab('upload');
            }
        }
        
        // ========== QUESTION MANAGEMENT ==========
        function loadDayQuestions(dayNum) {
            if (!dayNum) return;
            
            database.ref(`questions/day${dayNum}`).once('value')
                .then(snapshot => {
                    const questions = snapshot.val();
                    const count = snapshot.numChildren() || 0;
                    
                    // Update status
                    document.getElementById('selectedStatus').textContent = `${count}/15 questions uploaded`;
                    document.getElementById('detailQuestions').textContent = `${count}/15 uploaded`;
                    document.getElementById('detailStatus').textContent = count >= 15 ? 'Complete' : count > 0 ? 'Partial' : 'Empty';
                    document.getElementById('currentDayDisplay').textContent = dayNum;
                    
                    // Update day box
                    updateDayBoxStatus(dayNum, count);
                    
                    // Display questions
                    displayQuestionsList(questions);
                    
                    // Update last updated
                    if (count > 0) {
                        database.ref(`schedule/day${dayNum}/lastUpdated`).once('value')
                            .then(dateSnapshot => {
                                if (dateSnapshot.exists()) {
                                    const date = new Date(dateSnapshot.val());
                                    document.getElementById('detailUpdated').textContent = date.toLocaleString();
                                }
                            });
                    }
                })
                .catch(error => {
                    console.error('Error loading questions:', error);
                });
        }
        
        function displayQuestionsList(questions) {
            const container = document.getElementById('questionsList');
            
            if (!questions || Object.keys(questions).length === 0) {
                container.innerHTML = '<p style="color: #718096; padding: 20px; text-align: center; background: #f7fafc; border-radius: 8px;">No questions uploaded yet for this day.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            Object.values(questions).forEach((q, index) => {
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong style="color: #2d3748;">Q${index + 1}:</strong> ${q.question}
                            </div>
                            <button onclick="deleteQuestion(${currentSelectedDay}, 'q${index + 1}')" style="padding: 5px 10px; font-size: 12px;" class="red">Delete</button>
                        </div>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="color: ${q.answer === 'A' ? '#48bb78' : '#718096'}">A. ${q.options.A}</div>
                            <div style="color: ${q.answer === 'B' ? '#48bb78' : '#718096'}">B. ${q.options.B}</div>
                            <div style="color: ${q.answer === 'C' ? '#48bb78' : '#718096'}">C. ${q.options.C}</div>
                            <div style="color: ${q.answer === 'D' ? '#48bb78' : '#718096'}">D. ${q.options.D}</div>
                        </div>
                        ${q.explanation ? `<div style="margin-top: 10px; padding: 10px; background: #e6f7ff; border-radius: 5px;"><strong>Explanation:</strong> ${q.explanation}</div>` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ========== UPLOAD FUNCTIONS ==========
        function uploadJSON() {
            const dayNum = currentSelectedDay;
            const jsonText = document.getElementById('jsonUpload').value;
            
            if (!dayNum) {
                alert('Please select a day first.');
                return;
            }
            
            if (!jsonText) {
                alert('Please paste JSON data.');
                return;
            }
            
            try {
                const data = JSON.parse(jsonText);
                
                // Validate structure
                if (!data.questions || !Array.isArray(data.questions)) {
                    throw new Error('JSON must contain "questions" array');
                }
                
                // Process questions
                const updates = {};
                const questions = {};
                
                data.questions.forEach((q, index) => {
                    if (!q.question || !q.options || !q.answer) {
                        throw new Error(`Question ${index + 1} is missing required fields`);
                    }
                    
                    const questionId = `q${index + 1}`;
                    questions[questionId] = {
                        question: q.question,
                        options: q.options,
                        answer: q.answer,
                        explanation: q.explanation || '',
                        id: index + 1
                    };
                });
                
                updates[`questions/day${dayNum}`] = questions;
                updates[`schedule/day${dayNum}`] = {
                    ...schedule.find(d => d.day === dayNum),
                    totalQuestions: data.questions.length,
                    lastUpdated: new Date().toISOString()
                };
                
                // Save to Firebase
                database.ref().update(updates)
                    .then(() => {
                        alert(`‚úÖ Successfully uploaded ${data.questions.length} questions for Day ${dayNum}!`);
                        loadDayQuestions(dayNum);
                        document.getElementById('jsonUpload').value = '';
                    })
                    .catch(error => {
                        alert('‚ùå Error uploading: ' + error.message);
                    });
                    
            } catch (error) {
                alert('‚ùå Invalid JSON: ' + error.message);
            }
        }
        
        function addSingleQuestion() {
            const dayNum = currentSelectedDay;
            
            if (!dayNum) {
                alert('Please select a day first.');
                return;
            }
            
            // Get form values
            const question = document.getElementById('questionText').value.trim();
            const options = {
                A: document.getElementById('optA').value.trim(),
                B: document.getElementById('optB').value.trim(),
                C: document.getElementById('optC').value.trim(),
                D: document.getElementById('optD').value.trim()
            };
            const answer = document.getElementById('correctOption').value;
            const explanation = document.getElementById('explanation').value.trim();
            
            // Validation
            if (!question) {
                alert('Please enter question text.');
                return;
            }
            
            if (!options.A || !options.B || !options.C || !options.D) {
                alert('Please fill all four options.');
                return;
            }
            
            if (!answer) {
                alert('Please select the correct answer.');
                return;
            }
            
            // Get next question number
            database.ref(`questions/day${dayNum}`).once('value')
                .then(snapshot => {
                    const count = snapshot.numChildren() || 0;
                    
                    if (count >= 15) {
                        alert('This day already has 15 questions. Maximum limit reached.');
                        return;
                    }
                    
                    const questionId = `q${count + 1}`;
                    const newQuestion = {
                        question: question,
                        options: options,
                        answer: answer,
                        explanation: explanation,
                        id: count + 1
                    };
                    
                    // Save to Firebase
                    database.ref(`questions/day${dayNum}/${questionId}`).set(newQuestion)
                        .then(() => {
                            // Clear form
                            document.getElementById('questionText').value = '';
                            document.getElementById('optA').value = '';
                            document.getElementById('optB').value = '';
                            document.getElementById('optC').value = '';
                            document.getElementById('optD').value = '';
                            document.getElementById('correctOption').value = '';
                            document.getElementById('explanation').value = '';
                            
                            // Update UI
                            loadDayQuestions(dayNum);
                            alert('‚úÖ Question added successfully!');
                        })
                        .catch(error => {
                            alert('‚ùå Error saving question: ' + error.message);
                        });
                });
        }
        
        function deleteQuestion(dayNum, questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                database.ref(`questions/day${dayNum}/${questionId}`).remove()
                    .then(() => {
                        loadDayQuestions(dayNum);
                        alert('‚úÖ Question deleted.');
                    })
                    .catch(error => {
                        alert('‚ùå Error deleting question: ' + error.message);
                    });
            }
        }
        
        function clearDayQuestions() {
            const dayNum = currentSelectedDay;
            
            if (confirm(`Are you sure you want to delete ALL questions for Day ${dayNum}?`)) {
                database.ref(`questions/day${dayNum}`).remove()
                    .then(() => {
                        database.ref(`schedule/day${dayNum}`).update({lastUpdated: new Date().toISOString()})
                            .then(() => {
                                loadDayQuestions(dayNum);
                                alert('‚úÖ All questions cleared.');
                            });
                    })
                    .catch(error => {
                        alert('‚ùå Error clearing questions: ' + error.message);
                    });
            }
        }
        
        // ========== DAY BOX STATUS ==========
        function updateDayBoxStatus(dayNum, count) {
            const dayBox = document.querySelectorAll('.day-box')[dayNum - 1];
            if (!dayBox) return;
            
            if (count >= 15) {
                dayBox.className = 'day-box full';
            } else if (count > 0) {
                dayBox.className = 'day-box partial';
            } else {
                dayBox.className = 'day-box empty';
            }
        }
        
        function updateAllDayBoxes() {
            for (let dayNum = 1; dayNum <= 82; dayNum++) {
                database.ref(`questions/day${dayNum}`).once('value')
                    .then(snapshot => {
                        const count = snapshot.numChildren() || 0;
                        updateDayBoxStatus(dayNum, count);
                    });
            }
        }
        
        // ========== USER MANAGEMENT ==========
        function loadAllUsers() {
            database.ref('users').once('value')
                .then(snapshot => {
                    const users = snapshot.val();
                    const tbody = document.getElementById('usersTable');
                    const certSelect = document.getElementById('certStudent');
                    
                    // Clear
                    tbody.innerHTML = '';
                    certSelect.innerHTML = '<option value="">-- Select Student --</option>';
                    
                    if (!users) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px; color: #718096;">No students yet.</td></tr>';
                        return;
                    }
                    
                    // Process each user
                    Object.entries(users).forEach(([userId, user]) => {
                        // Calculate statistics
                        const completedDays = user.completedDays || [];
                        const progress = Math.round((completedDays.length / 82) * 100);
                        
                        let totalScore = 0;
                        let totalTests = 0;
                        
                        if (user.scores) {
                            Object.values(user.scores).forEach(score => {
                                totalScore += (score.score / score.total) * 100;
                                totalTests++;
                            });
                        }
                        
                        const avgScore = totalTests > 0 ? (totalScore / totalTests).toFixed(1) : 'N/A';
                        
                        // Add to table
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td><strong>${user.name}</strong></td>
                            <td>${user.currentDay || 1}</td>
                            <td>
                                <div style="background: #e2e8f0; height: 10px; border-radius: 5px; width: 100px; display: inline-block; margin-right: 10px;">
                                    <div style="background: #48bb78; height: 100%; width: ${progress}%; border-radius: 5px;"></div>
                                </div>
                                ${progress}%
                            </td>
                            <td>${avgScore}%</td>
                            <td>${user.lastActive ? new Date(user.lastActive).toLocaleDateString() : 'Never'}</td>
                            <td>
                                <button onclick="viewUserProgress('${userId}')" style="padding: 5px 10px; font-size: 12px;">View</button>
                                <button onclick="deleteUser('${userId}')" style="padding: 5px 10px; font-size: 12px;" class="red">Delete</button>
                            </td>
                        `;
                        
                        // Add to certificate dropdown
                        const option = document.createElement('option');
                        option.value = userId;
                        option.textContent = user.name + ` (Progress: ${progress}%)`;
                        certSelect.appendChild(option);
                    });
                });
        }
        
        function viewUserProgress(userId) {
            alert('View progress feature would open detailed view for user: ' + userId);
            // You can implement a modal with detailed progress
        }
        
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this student and all their progress?')) {
                database.ref(`users/${userId}`).remove()
                    .then(() => {
                        loadAllUsers();
                        alert('‚úÖ Student deleted.');
                    })
                    .catch(error => {
                        alert('‚ùå Error deleting student: ' + error.message);
                    });
            }
        }
        
        // ========== CERTIFICATE FUNCTIONS ==========
        function generateCertificate() {
            const userId = document.getElementById('certStudent').value;
            
            if (!userId) {
                alert('Please select a student.');
                return;
            }
            
            database.ref(`users/${userId}`).once('value')
                .then(snapshot => {
                    const user = snapshot.val();
                    if (!user) {
                        alert('Student not found.');
                        return;
                    }
                    
                    // Calculate completion
                    const completedDays = user.completedDays || [];
                    const progress = Math.round((completedDays.length / 82) * 100);
                    
                    // Generate certificate data
                    document.getElementById('certName').textContent = user.name;
                    document.getElementById('certStart').textContent = user.startDate || schedule[0].date;
                    document.getElementById('certEnd').textContent = schedule[81].date;
                    document.getElementById('certScore').textContent = `${progress}%`;
                    document.getElementById('certID').textContent = `NEET2026-${userId.substring(0, 8).toUpperCase()}`;
                    document.getElementById('certDate').textContent = new Date().toLocaleDateString();
                    
                    // Show certificate
                    document.getElementById('certificateContainer').style.display = 'block';
                    
                    // Scroll to certificate
                    document.getElementById('certificateContainer').scrollIntoView({behavior: 'smooth'});
                });
        }
        
        function printCertificate() {
            window.print();
        }
        
        function downloadCertificate() {
            alert('Certificate download feature would save as PDF/PNG');
            // Implement using html2canvas or similar library
        }
        
        // ========== UTILITY FUNCTIONS ==========
        function goToDayEdit() {
            showTab('upload');
            loadDayQuestions(currentSelectedDay);
        }
        
        function exportToCSV() {
            alert('CSV export feature would download all student data');
            // Implement CSV generation
        }
    </script>
</body>
</html>
