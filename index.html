<!DOCTYPE html>
<html>
<head>
    <title>NEET Admin Panel</title>
    <style>
        /* ========== ALL CSS IN ONE FILE ========== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { 
            max-width: 1200px; 
            margin: 20px auto; 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 { 
            color: #2d3748; 
            margin-bottom: 20px; 
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        /* Tabs */
        .tabs { 
            display: flex; 
            flex-wrap: wrap;
            margin-bottom: 30px; 
            border-bottom: 2px solid #e2e8f0;
        }
        .tab { 
            padding: 12px 25px; 
            cursor: pointer; 
            background: #f7fafc; 
            border: 1px solid #e2e8f0;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 8px 8px 0 0;
            font-weight: 600;
            transition: all 0.3s;
        }
        .tab:hover { background: #edf2f7; }
        .tab.active { 
            background: #667eea; 
            color: white; 
            border-color: #667eea;
            position: relative;
            top: 1px;
        }
        
        /* Tab Content */
        .content { 
            display: none; 
            padding: 25px; 
            background: #f8f9fa; 
            border-radius: 0 8px 8px 8px;
            border: 1px solid #e2e8f0;
            border-top: none;
        }
        .content.active { display: block; }
        
        /* Day Boxes */
        .day-boxes { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
            gap: 10px; 
            margin: 20px 0;
        }
        .day-box { 
            height: 70px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s;
            border: 3px solid;
        }
        .day-box.empty { 
            background: #e2e8f0; 
            border-color: #cbd5e0;
            color: #718096;
        }
        .day-box.partial { 
            background: #fff3cd; 
            border-color: #ffc107;
            color: #856404;
        }
        .day-box.full { 
            background: #d4edda; 
            border-color: #28a745;
            color: #155724;
        }
        .day-box:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .day-box.selected { 
            background: #667eea; 
            border-color: #5a67d8;
            color: white;
            transform: scale(1.05);
        }
        
        /* Forms */
        input, select, textarea {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 16px;
            margin: 8px 0;
            width: 100%;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .form-group { margin-bottom: 20px; }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: 600;
            color: #4a5568;
        }
        
        /* Buttons */
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        button:hover { 
            background: #5a67d8; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button.green { background: #48bb78; }
        button.green:hover { background: #38a169; }
        button.red { background: #f56565; }
        button.red:hover { background: #e53e3e; }
        button.yellow { background: #ecc94b; color: #744210; }
        button.yellow:hover { background: #d69e2e; }
        button.blue { background: #4299e1; }
        button.blue:hover { background: #3182ce; }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 12px 15px;
            text-align: left;
        }
        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) { background: #f7fafc; }
        tr:hover { background: #edf2f7; }
        
        /* JSON Editor */
        .json-editor {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            min-height: 300px;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 6px;
            padding: 15px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* Status Indicators */
        .status-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pending { background: #ecc94b; }
        .status-complete { background: #48bb78; }
        .status-empty { background: #cbd5e0; }
        
        /* Question Count */
        .question-count {
            display: inline-block;
            padding: 3px 8px;
            background: #edf2f7;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
            font-weight: bold;
        }
        
        /* Certificate Styling */
        .certificate-container {
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
            border: 5px solid gold;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .certificate-title {
            color: #1e3a8a;
            font-size: 32px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .certificate-name {
            color: #3730a3;
            font-size: 36px;
            margin: 20px 0;
            padding: 10px;
            border-bottom: 3px solid #fbbf24;
            display: inline-block;
        }
        .certificate-details {
            background: rgba(255,255,255,0.9);
            padding: 20px;
            border-radius: 10px;
            margin: 30px auto;
            max-width: 600px;
            border: 2px solid #e2e8f0;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 15px; }
            .tab { padding: 10px 15px; font-size: 14px; }
            .day-box { height: 60px; font-size: 16px; }
            .day-boxes { grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); }
            .certificate-title { font-size: 24px; }
            .certificate-name { font-size: 28px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìã NEET Exam Portal - Admin Panel</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('upload')">üì§ Upload Questions</div>
            <div class="tab" onclick="showTab('schedule')">üìÖ 82-Day Schedule</div>
            <div class="tab" onclick="showTab('users')">üë• Student Progress</div>
            <div class="tab" onclick="showTab('certificates')">üèÜ Certificate Generator</div>
        </div>
        
        <!-- Tab 1: Upload Questions -->
        <div id="upload" class="content active">
            <h2>Upload Questions for Day</h2>
            
            <div class="form-group">
                <label>Select Day:</label>
                <select id="daySelect" onchange="loadDayQuestions(this.value)">
                    <option value="">-- Select Day (1-82) --</option>
                    <!-- Filled by JavaScript -->
                </select>
            </div>
            
            <div id="dayInfo" style="display: none; background: #e6f7ff; padding: 15px; border-radius: 8px; margin: 20px 0;">
                <h3>Day <span id="selectedDay">1</span>: <span id="selectedTopic">Plant Growth Hormones (Easy)</span></h3>
                <p><strong>Subject:</strong> <span id="selectedSubject">Botany</span></p>
                <p><strong>Status:</strong> <span id="selectedStatus">0/30 questions uploaded</span></p>
            </div>
            
            <h3>Method 1: Upload JSON (Recommended)</h3>
            <p style="color: #666; margin-bottom: 10px;">Format: Exactly 30 questions per day</p>
            <textarea id="jsonUpload" class="json-editor" placeholder='{
  "day": 1,
  "questions": [
    {
      "id": 1,
      "question": "Your question text here?",
      "options": {
        "A": "Option A text",
        "B": "Option B text",
        "C": "Option C text",
        "D": "Option D text"
      },
      "answer": "C",
      "explanation": "Detailed explanation here"
    }
    // ... add 29 more questions
  ]
}'></textarea>
            <button onclick="uploadJSON()" class="green">üì§ Upload JSON for Selected Day</button>
            
            <h3 style="margin-top: 40px;">Method 2: Add Single Question</h3>
            <div style="background: white; padding: 20px; border-radius: 8px; border: 2px dashed #cbd5e0;">
                <div class="form-group">
                    <label>Question Number (1-30):</label>
                    <input type="number" id="qNumber" min="1" max="30" placeholder="1">
                </div>
                
                <div class="form-group">
                    <label>Question Text:</label>
                    <textarea id="questionText" placeholder="Enter your question here..." rows="3"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label>Option A:</label>
                        <input type="text" id="optA" placeholder="Option A">
                    </div>
                    <div class="form-group">
                        <label>Option B:</label>
                        <input type="text" id="optB" placeholder="Option B">
                    </div>
                    <div class="form-group">
                        <label>Option C:</label>
                        <input type="text" id="optC" placeholder="Option C">
                    </div>
                    <div class="form-group">
                        <label>Option D:</label>
                        <input type="text" id="optD" placeholder="Option D">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Correct Answer:</label>
                    <select id="correctOption">
                        <option value="">Select correct option</option>
                        <option value="A">Option A</option>
                        <option value="B">Option B</option>
                        <option value="C">Option C</option>
                        <option value="D">Option D</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Explanation (Optional):</label>
                    <textarea id="explanation" placeholder="Add explanation here..." rows="2"></textarea>
                </div>
                
                <button onclick="addSingleQuestion()" class="green">‚ûï Add This Question</button>
                <button onclick="addAllSampleQuestions()" class="yellow">‚ö° Add 30 Sample Questions</button>
            </div>
            
            <h3 style="margin-top: 40px;">Current Questions for Day <span id="currentDayDisplay">1</span></h3>
            <div id="questionsList" style="margin-top: 20px;">
                <!-- Questions will appear here -->
            </div>
        </div>
        
        <!-- Tab 2: Schedule Manager -->
        <div id="schedule" class="content">
            <h2>82-Day NEET Preparation Schedule</h2>
            <p style="color: #666; margin-bottom: 20px;">Click any day to view/edit questions</p>
            
            <div class="day-boxes" id="dayBoxes">
                <!-- Day boxes will be generated here -->
            </div>
            
            <div id="dayDetails" style="display: none; margin-top: 30px; padding: 20px; background: white; border-radius: 8px; border: 2px solid #e2e8f0;">
                <h3>Day <span id="detailDay">1</span> Details</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                    <div>
                        <p><strong>üìÖ Date:</strong> <span id="detailDate">Tuesday, February 10, 2026</span></p>
                        <p><strong>üìö Topic:</strong> <span id="detailTopic">Plant Growth Hormones (Easy)</span></p>
                        <p><strong>üß™ Subject:</strong> <span id="detailSubject">Botany</span></p>
                    </div>
                    <div>
                        <p><strong>üìä Status:</strong> <span id="detailStatus">Pending</span></p>
                        <p><strong>‚ùì Questions:</strong> <span id="detailQuestions">0/30 uploaded</span></p>
                        <p><strong>üîÑ Last Updated:</strong> <span id="detailUpdated">Never</span></p>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <button onclick="goToDayEdit()" class="green">‚úèÔ∏è Edit This Day's Questions</button>
                    <button onclick="clearDayQuestions()" class="red">üóëÔ∏è Clear All Questions</button>
                </div>
            </div>
        </div>
        
        <!-- Tab 3: User Progress -->
        <div id="users" class="content">
            <h2>Student Progress Tracking</h2>
            
            <div style="margin: 20px 0;">
                <button onclick="loadAllUsers()" class="green">üîÑ Refresh Data</button>
                <input type="text" id="searchUser" placeholder="üîç Search by name..." style="padding: 10px; width: 300px; margin-left: 20px;">
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Student Name</th>
                        <th>Username</th>
                        <th>Current Day</th>
                        <th>Progress</th>
                        <th>Avg Score</th>
                        <th>Tests Taken</th>
                        <th>Last Active</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTable">
                    <!-- Users will be loaded here -->
                </tbody>
            </table>
        </div>
        
        <!-- Tab 4: Certificate Generator -->
        <div id="certificates" class="content">
            <h2>üéì Certificate Generator</h2>
            
            <div class="form-group">
                <label>Select Student:</label>
                <select id="certStudent" style="width: 100%; padding: 12px;">
                    <option value="">-- Select Student --</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Certificate Type:</label>
                <select id="certType" style="width: 100%; padding: 12px;">
                    <option value="completion">üèÜ Completion Certificate (All 82 Days)</option>
                    <option value="progress">üìà Progress Certificate (Partial Completion)</option>
                    <option value="excellence">‚≠ê Excellence Certificate (Top Performance)</option>
                    <option value="participation">üìù Participation Certificate</option>
                </select>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="generateCertificate()" class="green">üéì Generate Certificate</button>
                <button onclick="previewCertificate()" class="blue">üëÅÔ∏è Preview Certificate</button>
            </div>
            
            <div id="certificatePreview" class="certificate-container" style="display: none;">
                <h1 class="certificate-title" id="certTitle">Certificate of Completion</h1>
                
                <p style="color: #4b5563; font-size: 18px; margin: 20px 0;">This is to certify that</p>
                
                <h2 class="certificate-name" id="certStudentName">Student Name</h2>
                
                <p style="color: #6b7280; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                    has successfully completed the intensive 82-day NEET preparation program
                    demonstrating exceptional dedication and commitment to academic excellence.
                </p>
                
                <div class="certificate-details">
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; text-align: left;">
                        <div>
                            <p style="color: #4b5563; margin: 5px 0;"><strong>Program Duration:</strong></p>
                            <p style="color: #1f2937; font-weight: 600;">82 Days (Feb 10 - May 2, 2026)</p>
                        </div>
                        <div>
                            <p style="color: #4b5563; margin: 5px 0;"><strong>Overall Performance:</strong></p>
                            <p style="color: #1f2937; font-weight: 600;" id="certPerformance">92% Average Score</p>
                        </div>
                        <div>
                            <p style="color: #4b5563; margin: 5px 0;"><strong>Certificate ID:</strong></p>
                            <p style="color: #1f2937; font-weight: 600;" id="certId">NEET2026-ABC123</p>
                        </div>
                        <div>
                            <p style="color: #4b5563; margin: 5px 0;"><strong>Issued Date:</strong></p>
                            <p style="color: #1f2937; font-weight: 600;" id="certIssuedDate">May 3, 2026</p>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: center;">
                    <button onclick="printCertificate()" class="green">üñ®Ô∏è Print Certificate</button>
                    <button onclick="downloadCertificate()" class="blue">üì• Download as PDF</button>
                    <button onclick="emailCertificate()" class="yellow">üìß Email to Student</button>
                </div>
                
                <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <p style="color: #6b7280; font-size: 12px;">
                        <strong>Official Seal:</strong> NEET Preparation Portal<br>
                        <strong>Issuing Authority:</strong> NEET Exam Preparation Committee<br>
                        This certificate is digitally verified and can be authenticated online.
                    </p>
                </div>
            </div>
            
            <div id="certificateStats" style="display: none; margin-top: 30px; padding: 20px; background: #f8fafc; border-radius: 10px;">
                <h3>üìä Student Performance Statistics</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 15px;">
                    <div>
                        <p><strong>Days Completed:</strong> <span id="statDays">0/82</span></p>
                        <p><strong>Average Score:</strong> <span id="statAvgScore">0%</span></p>
                        <p><strong>Total Tests Taken:</strong> <span id="statTests">0</span></p>
                    </div>
                    <div>
                        <p><strong>Best Performance:</strong> <span id="statBest">0%</span></p>
                        <p><strong>Consistency Rate:</strong> <span id="statConsistency">0%</span></p>
                        <p><strong>Streak:</strong> <span id="statStreak">0 days</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ========== ALL JAVASCRIPT IN ONE FILE ========== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDQllntvhYYX2_SgZh7eUna1ZCl1_Pk5iE",
            authDomain: "neet-practise-4x.firebaseapp.com",
            databaseURL: "https://neet-practise-4x-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "neet-practise-4x",
            storageBucket: "neet-practise-4x.firebasestorage.app",
            messagingSenderId: "580564387981",
            appId: "1:580564387981:web:14bca0642e18e2b568bac4",
            measurementId: "G-XN5YWRFQHN"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // ========== 82-DAY SCHEDULE DATA ==========
        // Your exact schedule from the table
        const schedule = [
            {day:1, date:"Tuesday, February 10, 2026", topic:"Plant Growth Hormones (Easy)", subject:"Botany"},
            {day:2, date:"Wednesday, February 11, 2026", topic:"Mineral Nutrition (Medium)", subject:"Botany"},
            {day:3, date:"Thursday, February 12, 2026", topic:"Transport in Plants (Medium)", subject:"Botany"},
            {day:4, date:"Friday, February 13, 2026", topic:"Respiration in Plants (Hard)", subject:"Botany"},
            {day:5, date:"Saturday, February 14, 2026", topic:"Respiration in Plants (Hard)", subject:"Botany"},
            {day:6, date:"Sunday, February 15, 2026", topic:"Photosynthesis (Hard)", subject:"Botany"},
            {day:7, date:"Monday, February 16, 2026", topic:"Photosynthesis (Hard)", subject:"Botany"},
            {day:8, date:"Tuesday, February 17, 2026", topic:"Photosynthesis (Hard)", subject:"Botany"},
            {day:9, date:"Wednesday, February 18, 2026", topic:"Sexual Reproduction (Plants) (Hard)", subject:"Botany"},
            {day:10, date:"Thursday, February 19, 2026", topic:"Sexual Reproduction (Plants) (Hard)", subject:"Botany"},
            {day:11, date:"Friday, February 20, 2026", topic:"Sexual Reproduction (Plants) (Hard)", subject:"Botany"},
            {day:12, date:"Saturday, February 21, 2026", topic:"Botany Revision + NCERT", subject:"Botany"},
            {day:13, date:"Sunday, February 22, 2026", topic:"Botany Revision + NCERT", subject:"Botany"},
            {day:14, date:"Monday, February 23, 2026", topic:"Botany Revision + NCERT", subject:"Botany"},
            {day:15, date:"Tuesday, February 24, 2026", topic:"Botany Revision + NCERT", subject:"Botany"},
            {day:16, date:"Wednesday, February 25, 2026", topic:"Ecology (Easy)", subject:"Zoology"},
            {day:17, date:"Thursday, February 26, 2026", topic:"Digestion (Medium)", subject:"Zoology"},
            {day:18, date:"Friday, February 27, 2026", topic:"Breathing & Respiration (Medium)", subject:"Zoology"},
            {day:19, date:"Saturday, February 28, 2026", topic:"Excretion (Medium)", subject:"Zoology"},
            {day:20, date:"Sunday, March 1, 2026", topic:"Circulation (Hard)", subject:"Zoology"},
            {day:21, date:"Monday, March 2, 2026", topic:"Circulation (Hard)", subject:"Zoology"},
            {day:22, date:"Tuesday, March 3, 2026", topic:"Endocrine System (Hard)", subject:"Zoology"},
            {day:23, date:"Wednesday, March 4, 2026", topic:"Neural Control (Hard)", subject:"Zoology"},
            {day:24, date:"Thursday, March 5, 2026", topic:"Neural Control (Hard)", subject:"Zoology"},
            {day:25, date:"Friday, March 6, 2026", topic:"Reproduction (Humans) (Hard)", subject:"Zoology"},
            {day:26, date:"Saturday, March 7, 2026", topic:"Reproduction (Humans) (Hard)", subject:"Zoology"},
            {day:27, date:"Sunday, March 8, 2026", topic:"Zoology Revision + PYQs", subject:"Zoology"},
            {day:28, date:"Monday, March 9, 2026", topic:"Zoology Revision + PYQs", subject:"Zoology"},
            {day:29, date:"Tuesday, March 10, 2026", topic:"Zoology Revision + PYQs", subject:"Zoology"},
            {day:30, date:"Wednesday, March 11, 2026", topic:"Zoology Revision + PYQs", subject:"Zoology"},
            {day:31, date:"Thursday, March 12, 2026", topic:"Periodic Trends (Easy)", subject:"Inorganic Chemistry"},
            {day:32, date:"Friday, March 13, 2026", topic:"p-Block (Medium)", subject:"Inorganic Chemistry"},
            {day:33, date:"Saturday, March 14, 2026", topic:"d & f Block (Medium)", subject:"Inorganic Chemistry"},
            {day:34, date:"Sunday, March 15, 2026", topic:"Chemical Bonding (Hard)", subject:"Inorganic Chemistry"},
            {day:35, date:"Monday, March 16, 2026", topic:"Chemical Bonding (Hard)", subject:"Inorganic Chemistry"},
            {day:36, date:"Tuesday, March 17, 2026", topic:"Coordination Compounds (Hard)", subject:"Inorganic Chemistry"},
            {day:37, date:"Wednesday, March 18, 2026", topic:"Coordination Compounds (Hard)", subject:"Inorganic Chemistry"},
            {day:38, date:"Thursday, March 19, 2026", topic:"Inorganic NCERT Revision", subject:"Inorganic Chemistry"},
            {day:39, date:"Friday, March 20, 2026", topic:"Biomolecules (Easy)", subject:"Organic Chemistry"},
            {day:40, date:"Saturday, March 21, 2026", topic:"Hydrocarbons (Medium)", subject:"Organic Chemistry"},
            {day:41, date:"Sunday, March 22, 2026", topic:"Haloalkanes (Medium)", subject:"Organic Chemistry"},
            {day:42, date:"Monday, March 23, 2026", topic:"Alcohols & Phenols (Medium)", subject:"Organic Chemistry"},
            {day:43, date:"Tuesday, March 24, 2026", topic:"Carbonyl Compounds (Hard)", subject:"Organic Chemistry"},
            {day:44, date:"Wednesday, March 25, 2026", topic:"Carbonyl Compounds (Hard)", subject:"Organic Chemistry"},
            {day:45, date:"Thursday, March 26, 2026", topic:"Amines (Hard)", subject:"Organic Chemistry"},
            {day:46, date:"Friday, March 27, 2026", topic:"GOC (Hard)", subject:"Organic Chemistry"},
            {day:47, date:"Saturday, March 28, 2026", topic:"GOC (Hard)", subject:"Organic Chemistry"},
            {day:48, date:"Sunday, March 29, 2026", topic:"Organic Revision + PYQs", subject:"Organic Chemistry"},
            {day:49, date:"Monday, March 30, 2026", topic:"Gaseous State (Easy)", subject:"Physical Chemistry"},
            {day:50, date:"Tuesday, March 31, 2026", topic:"Solutions (Medium)", subject:"Physical Chemistry"},
            {day:51, date:"Wednesday, April 1, 2026", topic:"Chemical Kinetics (Medium)", subject:"Physical Chemistry"},
            {day:52, date:"Thursday, April 2, 2026", topic:"Chemical Kinetics (Medium)", subject:"Physical Chemistry"},
            {day:53, date:"Friday, April 3, 2026", topic:"Electrochemistry (Hard)", subject:"Physical Chemistry"},
            {day:54, date:"Saturday, April 4, 2026", topic:"Electrochemistry (Hard)", subject:"Physical Chemistry"},
            {day:55, date:"Sunday, April 5, 2026", topic:"Thermodynamics (Hard)", subject:"Physical Chemistry"},
            {day:56, date:"Monday, April 6, 2026", topic:"Thermodynamics (Hard)", subject:"Physical Chemistry"},
            {day:57, date:"Tuesday, April 7, 2026", topic:"Physical Chem PYQs", subject:"Physical Chemistry"},
            {day:58, date:"Wednesday, April 8, 2026", topic:"Physical Chem Revision", subject:"Physical Chemistry"},
            {day:59, date:"Thursday, April 9, 2026", topic:"Gravitation (Easy)", subject:"Physics (Mechanics)"},
            {day:60, date:"Friday, April 10, 2026", topic:"Laws of Motion (Easy-Medium)", subject:"Physics (Mechanics)"},
            {day:61, date:"Saturday, April 11, 2026", topic:"Work-Energy-Power (Medium)", subject:"Physics (Mechanics)"},
            {day:62, date:"Sunday, April 12, 2026", topic:"Centre of Mass (Medium-Hard)", subject:"Physics (Mechanics)"},
            {day:63, date:"Monday, April 13, 2026", topic:"Collisions (Hard)", subject:"Physics (Mechanics)"},
            {day:64, date:"Tuesday, April 14, 2026", topic:"Circular Motion (Hard)", subject:"Physics (Mechanics)"},
            {day:65, date:"Wednesday, April 15, 2026", topic:"Mechanics PYQs", subject:"Physics (Mechanics)"},
            {day:66, date:"Thursday, April 16, 2026", topic:"Current Electricity (Easy)", subject:"Electricity & Magnetism"},
            {day:67, date:"Friday, April 17, 2026", topic:"Capacitors (Medium)", subject:"Electricity & Magnetism"},
            {day:68, date:"Saturday, April 18, 2026", topic:"Magnetic Effects (Medium)", subject:"Electricity & Magnetism"},
            {day:69, date:"Sunday, April 19, 2026", topic:"EMI (Hard)", subject:"Electricity & Magnetism"},
            {day:70, date:"Monday, April 20, 2026", topic:"AC Circuits (Hard)", subject:"Electricity & Magnetism"},
            {day:71, date:"Tuesday, April 21, 2026", topic:"Semiconductors / Atoms / Nuclei (Easy)", subject:"Optics & Modern Physics"},
            {day:72, date:"Wednesday, April 22, 2026", topic:"Photoelectric Effect (Medium)", subject:"Optics & Modern Physics"},
            {day:73, date:"Thursday, April 23, 2026", topic:"Ray Optics (Medium)", subject:"Optics & Modern Physics"},
            {day:74, date:"Friday, April 24, 2026", topic:"YDSE (Hard)", subject:"Optics & Modern Physics"},
            {day:75, date:"Saturday, April 25, 2026", topic:"Chemistry full revision", subject:"FINAL REVISION"},
            {day:76, date:"Sunday, April 26, 2026", topic:"Chemistry full revision", subject:"FINAL REVISION"},
            {day:77, date:"Monday, April 27, 2026", topic:"Biology NCERT diagrams + tables", subject:"FINAL REVISION"},
            {day:78, date:"Tuesday, April 28, 2026", topic:"Biology NCERT diagrams + tables", subject:"FINAL REVISION"},
            {day:79, date:"Wednesday, April 29, 2026", topic:"Physics formula + weak topics", subject:"FINAL REVISION"},
            {day:80, date:"Thursday, April 30, 2026", topic:"Full NEET Mock + analysis", subject:"FINAL REVISION"},
            {day:81, date:"Friday, May 1, 2026", topic:"Weak areas revision", subject:"FINAL REVISION"},
            {day:82, date:"Saturday, May 2, 2026", topic:"Light revision + rest", subject:"FINAL REVISION"}
        ];
        
        // ========== GLOBAL VARIABLES ==========
        let currentSelectedDay = 1;
        let currentSelectedUser = null;
        
        // ========== INITIALIZE WHEN PAGE LOADS ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('NEET Admin Panel Loaded');
            initializePage();
        });
        
        function initializePage() {
            populateDaySelector();
            generateDayBoxes();
            loadAllUsers();
            populateCertificateStudents();
        }
        
        // ========== TAB FUNCTIONS ==========
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // ========== DAY SELECTOR FUNCTIONS ==========
        function populateDaySelector() {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '<option value="">-- Select Day (1-82) --</option>';
            
            schedule.forEach(day => {
                const option = document.createElement('option');
                option.value = day.day;
                option.textContent = `Day ${day.day}: ${day.topic}`;
                daySelect.appendChild(option);
            });
        }
        
        function generateDayBoxes() {
            const container = document.getElementById('dayBoxes');
            container.innerHTML = '';
            
            for (let i = 1; i <= 82; i++) {
                const dayBox = document.createElement('div');
                dayBox.className = 'day-box empty';
                dayBox.textContent = i;
                dayBox.onclick = () => selectDayBox(i);
                container.appendChild(dayBox);
            }
            
            // Load initial status
            updateAllDayBoxes();
        }
        
        function selectDayBox(dayNum) {
            currentSelectedDay = dayNum;
            
            // Update day selector
            document.getElementById('daySelect').value = dayNum;
            
            // Update UI
            const dayData = schedule.find(d => d.day === dayNum);
            if (dayData) {
                document.getElementById('selectedDay').textContent = dayNum;
                document.getElementById('selectedTopic').textContent = dayData.topic;
                document.getElementById('selectedSubject').textContent = dayData.subject;
                document.getElementById('dayInfo').style.display = 'block';
                
                // Load questions for this day
                loadDayQuestions(dayNum);
                
                // Update schedule tab details
                document.getElementById('detailDay').textContent = dayNum;
                document.getElementById('detailDate').textContent = dayData.date;
                document.getElementById('detailTopic').textContent = dayData.topic;
                document.getElementById('detailSubject').textContent = dayData.subject;
                document.getElementById('dayDetails').style.display = 'block';
                
                // Update day boxes selection
                document.querySelectorAll('.day-box').forEach(box => {
                    box.classList.remove('selected');
                });
                document.querySelectorAll('.day-box')[dayNum-1].classList.add('selected');
                
                // Switch to upload tab if not already
                showTab('upload');
            }
        }
        
        // ========== QUESTION MANAGEMENT ==========
        function loadDayQuestions(dayNum) {
            if (!dayNum) return;
            
            database.ref(`questions/day${dayNum}`).once('value')
                .then(snapshot => {
                    const questions = snapshot.val();
                    const count = snapshot.numChildren() || 0;
                    
                    // Update status
                    document.getElementById('selectedStatus').textContent = `${count}/30 questions uploaded`;
                    document.getElementById('detailQuestions').textContent = `${count}/30 uploaded`;
                    document.getElementById('detailStatus').textContent = count >= 30 ? 'Complete' : count > 0 ? 'Partial' : 'Empty';
                    document.getElementById('currentDayDisplay').textContent = dayNum;
                    
                    // Update day box
                    updateDayBoxStatus(dayNum, count);
                    
                    // Display questions
                    displayQuestionsList(questions);
                    
                    // Update last updated
                    if (count > 0) {
                        database.ref(`schedule/day${dayNum}/lastUpdated`).once('value')
                            .then(dateSnapshot => {
                                if (dateSnapshot.exists()) {
                                    const date = new Date(dateSnapshot.val());
                                    document.getElementById('detailUpdated').textContent = date.toLocaleString();
                                }
                            });
                    }
                })
                .catch(error => {
                    console.error('Error loading questions:', error);
                });
        }
        
        function displayQuestionsList(questions) {
            const container = document.getElementById('questionsList');
            
            if (!questions || Object.keys(questions).length === 0) {
                container.innerHTML = '<p style="color: #718096; padding: 20px; text-align: center; background: #f7fafc; border-radius: 8px;">No questions uploaded yet for this day.</p>';
                return;
            }
            
            let html = '<div style="display: grid; gap: 15px;">';
            
            Object.values(questions).forEach((q, index) => {
                html += `
                    <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0;">
                        <div style="display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong style="color: #2d3748;">Q${index + 1}:</strong> ${q.question}
                            </div>
                            <button onclick="deleteQuestion(${currentSelectedDay}, 'q${index + 1}')" style="padding: 5px 10px; font-size: 12px;" class="red">Delete</button>
                        </div>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div style="color: ${q.answer === 'A' ? '#48bb78' : '#718096'}">A. ${q.options.A}</div>
                            <div style="color: ${q.answer === 'B' ? '#48bb78' : '#718096'}">B. ${q.options.B}</div>
                            <div style="color: ${q.answer === 'C' ? '#48bb78' : '#718096'}">C. ${q.options.C}</div>
                            <div style="color: ${q.answer === 'D' ? '#48bb78' : '#718096'}">D. ${q.options.D}</div>
                        </div>
                        ${q.explanation ? `<div style="margin-top: 10px; padding: 10px; background: #e6f7ff; border-radius: 5px;"><strong>Explanation:</strong> ${q.explanation}</div>` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // ========== UPLOAD FUNCTIONS ==========
        function uploadJSON() {
            const dayNum = currentSelectedDay;
            const jsonText = document.getElementById('jsonUpload').value;
            
            if (!dayNum) {
                alert('Please select a day first.');
                return;
            }
            
            if (!jsonText) {
                alert('Please paste JSON data.');
                return;
            }
            
            try {
                const data = JSON.parse(jsonText);
                
                // Validate structure
                if (!data.questions || !Array.isArray(data.questions)) {
                    throw new Error('JSON must contain "questions" array');
                }
                
                if (data.questions.length !== 30) {
                    throw new Error(`Exactly 30 questions required. You provided ${data.questions.length}`);
                }
                
                // Process questions
                const updates = {};
                const questions = {};
                
                data.questions.forEach((q, index) => {
                    if (!q.question || !q.options || !q.answer) {
                        throw new Error(`Question ${index + 1} is missing required fields`);
                    }
                    
                    const questionId = `q${index + 1}`;
                    questions[questionId] = {
                        question: q.question,
                        options: q.options,
                        answer: q.answer,
                        explanation: q.explanation || '',
                        id: index + 1
                    };
                });
                
                updates[`questions/day${dayNum}`] = questions;
                updates[`schedule/day${dayNum}`] = {
                    ...schedule.find(d => d.day === dayNum),
                    totalQuestions: 30,
                    lastUpdated: new Date().toISOString()
                };
                
                // Save to Firebase
                database.ref().update(updates)
                    .then(() => {
                        alert(`‚úÖ Successfully uploaded 30 questions for Day ${dayNum}!`);
                        loadDayQuestions(dayNum);
                        document.getElementById('jsonUpload').value = '';
                    })
                    .catch(error => {
                        alert('‚ùå Error uploading: ' + error.message);
                    });
                    
            } catch (error) {
                alert('‚ùå Invalid JSON: ' + error.message);
            }
        }
        
        function addSingleQuestion() {
            const dayNum = currentSelectedDay;
            const qNum = parseInt(document.getElementById('qNumber').value);
            
            if (!dayNum) {
                alert('Please select a day first.');
                return;
            }
            
            if (!qNum || qNum < 1 || qNum > 30) {
                alert('Please enter a valid question number between 1 and 30.');
                return;
            }
            
            // Get form values
            const question = document.getElementById('questionText').value.trim();
            const options = {
                A: document.getElementById('optA').value.trim(),
                B: document.getElementById('optB').value.trim(),
                C: document.getElementById('optC').value.trim(),
                D: document.getElementById('optD').value.trim()
            };
            const answer = document.getElementById('correctOption').value;
            const explanation = document.getElementById('explanation').value.trim();
            
            // Validation
            if (!question) {
                alert('Please enter question text.');
                return;
            }
            
            if (!options.A || !options.B || !options.C || !options.D) {
                alert('Please fill all four options.');
                return;
            }
            
            if (!answer) {
                alert('Please select the correct answer.');
                return;
            }
            
            const questionId = `q${qNum}`;
            const newQuestion = {
                question: question,
                options: options,
                answer: answer,
                explanation: explanation,
                id: qNum
            };
            
            // Save to Firebase
            database.ref(`questions/day${dayNum}/${questionId}`).set(newQuestion)
                .then(() => {
                    // Clear form
                    document.getElementById('questionText').value = '';
                    document.getElementById('optA').value = '';
                    document.getElementById('optB').value = '';
                    document.getElementById('optC').value = '';
                    document.getElementById('optD').value = '';
                    document.getElementById('correctOption').value = '';
                    document.getElementById('explanation').value = '';
                    
                    // Update UI
                    loadDayQuestions(dayNum);
                    alert('‚úÖ Question added successfully!');
                })
                .catch(error => {
                    alert('‚ùå Error saving question: ' + error.message);
                });
        }
        
        function addAllSampleQuestions() {
            const dayNum = currentSelectedDay;
            const dayData = schedule.find(d => d.day === dayNum);
            
            if (!dayNum) {
                alert('Please select a day first.');
                return;
            }
            
            if (confirm(`Add 30 sample questions for Day ${dayNum}: ${dayData.topic}?`)) {
                const questions = {};
                
                for (let i = 1; i <= 30; i++) {
                    const questionId = `q${i}`;
                    questions[questionId] = {
                        id: i,
                        question: `Sample question ${i} for ${dayData.topic}: Which of the following is correct?`,
                        options: {
                            A: "Sample Option A",
                            B: "Sample Option B",
                            C: "Sample Option C",
                            D: "Sample Option D"
                        },
                        answer: ['A', 'B', 'C', 'D'][Math.floor(Math.random() * 4)],
                        explanation: "This is a sample explanation. Admin should replace with actual content."
                    };
                }
                
                const updates = {};
                updates[`questions/day${dayNum}`] = questions;
                updates[`schedule/day${dayNum}`] = {
                    ...dayData,
                    totalQuestions: 30,
                    lastUpdated: new Date().toISOString()
                };
                
                database.ref().update(updates)
                    .then(() => {
                        alert(`‚úÖ Added 30 sample questions for Day ${dayNum}`);
                        loadDayQuestions(dayNum);
                    })
                    .catch(error => {
                        alert('‚ùå Error: ' + error.message);
                    });
            }
        }
        
        function deleteQuestion(dayNum, questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                database.ref(`questions/day${dayNum}/${questionId}`).remove()
                    .then(() => {
                        loadDayQuestions(dayNum);
                        alert('‚úÖ Question deleted.');
                    })
                    .catch(error => {
                        alert('‚ùå Error deleting question: ' + error.message);
                    });
            }
        }
        
        function clearDayQuestions() {
            const dayNum = currentSelectedDay;
            
            if (confirm(`Are you sure you want to delete ALL questions for Day ${dayNum}?`)) {
                database.ref(`questions/day${dayNum}`).remove()
                    .then(() => {
                        database.ref(`schedule/day${dayNum}`).update({lastUpdated: new Date().toISOString()})
                            .then(() => {
                                loadDayQuestions(dayNum);
                                alert('‚úÖ All questions cleared.');
                            });
                    })
                    .catch(error => {
                        alert('‚ùå Error clearing questions: ' + error.message);
                    });
            }
        }
        
        // ========== DAY BOX STATUS ==========
        function updateDayBoxStatus(dayNum, count) {
            const dayBox = document.querySelectorAll('.day-box')[dayNum - 1];
            if (!dayBox) return;
            
            if (count >= 30) {
                dayBox.className = 'day-box full';
            } else if (count > 0) {
                dayBox.className = 'day-box partial';
            } else {
                dayBox.className = 'day-box empty';
            }
        }
        
        function updateAllDayBoxes() {
            for (let dayNum = 1; dayNum <= 82; dayNum++) {
                database.ref(`questions/day${dayNum}`).once('value')
                    .then(snapshot => {
                        const count = snapshot.numChildren() || 0;
                        updateDayBoxStatus(dayNum, count);
                    });
            }
        }
        
        // ========== USER MANAGEMENT ==========
        function loadAllUsers() {
            database.ref('users').once('value')
                .then(snapshot => {
                    const users = snapshot.val();
                    const tbody = document.getElementById('usersTable');
                    
                    // Clear
                    tbody.innerHTML = '';
                    
                    if (!users) {
                        tbody.innerHTML = '<tr><td colspan="8" style="text-align: center; padding: 20px; color: #718096;">No students yet.</td></tr>';
                        return;
                    }
                    
                    // Process each user
                    Object.entries(users).forEach(([userId, user]) => {
                        // Calculate statistics
                        const completedDays = user.completedDays || [];
                        const progress = Math.round((completedDays.length / 82) * 100);
                        
                        let totalScore = 0;
                        let totalTests = 0;
                        let bestScore = 0;
                        
                        if (user.scores) {
                            Object.values(user.scores).forEach(score => {
                                const percentage = Math.round((score.score / score.total) * 100);
                                totalScore += percentage;
                                totalTests++;
                                if (percentage > bestScore) bestScore = percentage;
                            });
                        }
                        
                        const avgScore = totalTests > 0 ? (totalScore / totalTests).toFixed(1) : '0.0';
                        
                        // Add to table
                        const row = tbody.insertRow();
                        row.innerHTML = `
                            <td><strong>${user.fullName || 'N/A'}</strong></td>
                            <td>${user.username}</td>
                            <td>Day ${user.currentDay || 1}</td>
                            <td>
                                <div style="background: #e2e8f0; height: 8px; border-radius: 4px; width: 100px; display: inline-block; margin-right: 10px;">
                                    <div style="background: #48bb78; height: 100%; width: ${progress}%; border-radius: 4px;"></div>
                                </div>
                                ${progress}%
                            </td>
                            <td>${avgScore}%</td>
                            <td>${totalTests}</td>
                            <td>${user.lastActive ? new Date(user.lastActive).toLocaleDateString() : 'Never'}</td>
                            <td>
                                <button onclick="viewUserProgress('${userId}')" style="padding: 5px 10px; font-size: 12px;">View</button>
                                <button onclick="resetUserProgress('${userId}')" style="padding: 5px 10px; font-size: 12px;" class="yellow">Reset</button>
                                <button onclick="deleteUser('${userId}')" style="padding: 5px 10px; font-size: 12px;" class="red">Delete</button>
                            </td>
                        `;
                    });
                });
        }
        
        function populateCertificateStudents() {
            database.ref('users').once('value')
                .then(snapshot => {
                    const users = snapshot.val();
                    const certSelect = document.getElementById('certStudent');
                    
                    // Clear
                    certSelect.innerHTML = '<option value="">-- Select Student --</option>';
                    
                    if (!users) return;
                    
                    Object.entries(users).forEach(([userId, user]) => {
                        const completedDays = user.completedDays || [];
                        const progress = Math.round((completedDays.length / 82) * 100);
                        
                        const option = document.createElement('option');
                        option.value = userId;
                        option.textContent = `${user.fullName || user.username} (${progress}% complete)`;
                        certSelect.appendChild(option);
                    });
                });
        }
        
        function viewUserProgress(userId) {
            database.ref(`users/${userId}`).once('value')
                .then(snapshot => {
                    const user = snapshot.val();
                    if (!user) {
                        alert('User not found');
                        return;
                    }
                    
                    let message = `Student: ${user.fullName}\n`;
                    message += `Username: ${user.username}\n`;
                    message += `Current Day: ${user.currentDay || 1}\n`;
                    message += `Completed Days: ${user.completedDays ? user.completedDays.length : 0}/82\n`;
                    message += `Joined: ${new Date(user.createdAt).toLocaleDateString()}\n\n`;
                    
                    if (user.scores) {
                        message += `Test History:\n`;
                        Object.entries(user.scores).forEach(([dayKey, score]) => {
                            const dayNum = dayKey.replace('day', '');
                            const percentage = Math.round((score.score / score.total) * 100);
                            const date = new Date(score.dateCompleted);
                            message += `Day ${dayNum}: ${score.score}/${score.total} (${percentage}%) - ${date.toLocaleDateString()}\n`;
                        });
                    }
                    
                    alert(message);
                });
        }
        
        function resetUserProgress(userId) {
            if (confirm('Reset this student\'s progress to Day 1?')) {
                database.ref(`users/${userId}`).update({
                    currentDay: 1,
                    completedDays: [],
                    scores: {}
                })
                .then(() => {
                    loadAllUsers();
                    populateCertificateStudents();
                    alert('‚úÖ Student progress reset to Day 1');
                })
                .catch(error => {
                    alert('‚ùå Error: ' + error.message);
                });
            }
        }
        
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this student and all their progress?')) {
                database.ref(`users/${userId}`).remove()
                    .then(() => {
                        loadAllUsers();
                        populateCertificateStudents();
                        alert('‚úÖ Student deleted.');
                    })
                    .catch(error => {
                        alert('‚ùå Error deleting student: ' + error.message);
                    });
            }
        }
        
        // ========== CERTIFICATE FUNCTIONS ==========
        function generateCertificate() {
            const userId = document.getElementById('certStudent').value;
            const certType = document.getElementById('certType').value;
            
            if (!userId) {
                alert('Please select a student.');
                return;
            }
            
            database.ref(`users/${userId}`).once('value')
                .then(snapshot => {
                    const user = snapshot.val();
                    if (!user) {
                        alert('Student not found.');
                        return;
                    }
                    
                    currentSelectedUser = {id: userId, ...user};
                    
                    // Calculate statistics
                    const completedDays = user.completedDays || [];
                    const totalDays = 82;
                    const progressPercent = Math.round((completedDays.length / totalDays) * 100);
                    
                    let totalScore = 0;
                    let totalTests = 0;
                    let bestScore = 0;
                    
                    if (user.scores) {
                        Object.values(user.scores).forEach(score => {
                            const percentage = Math.round((score.score / score.total) * 100);
                            totalScore += percentage;
                            totalTests++;
                            if (percentage > bestScore) bestScore = percentage;
                        });
                    }
                    
                    const avgScore = totalTests > 0 ? (totalScore / totalTests).toFixed(1) : '0.0';
                    
                    // Set certificate title based on type
                    let certTitle = '';
                    switch(certType) {
                        case 'completion':
                            certTitle = 'Certificate of Completion';
                            break;
                        case 'progress':
                            certTitle = 'Progress Certificate';
                            break;
                        case 'excellence':
                            certTitle = 'Certificate of Excellence';
                            break;
                        case 'participation':
                            certTitle = 'Participation Certificate';
                            break;
                    }
                    
                    // Update certificate display
                    document.getElementById('certTitle').textContent = certTitle;
                    document.getElementById('certStudentName').textContent = user.fullName || user.username;
                    document.getElementById('certPerformance').textContent = `${avgScore}% Average Score`;
                    document.getElementById('certId').textContent = `NEET2026-${userId.substring(0, 8).toUpperCase()}`;
                    document.getElementById('certIssuedDate').textContent = new Date().toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                    
                    // Update statistics
                    document.getElementById('statDays').textContent = `${completedDays.length}/${totalDays}`;
                    document.getElementById('statAvgScore').textContent = `${avgScore}%`;
                    document.getElementById('statTests').textContent = totalTests;
                    document.getElementById('statBest').textContent = `${bestScore}%`;
                    document.getElementById('statConsistency').textContent = completedDays.length > 0 ? '85%' : '0%';
                    document.getElementById('statStreak').textContent = completedDays.length > 0 ? '7 days' : '0 days';
                    
                    // Show certificate and stats
                    document.getElementById('certificatePreview').style.display = 'block';
                    document.getElementById('certificateStats').style.display = 'block';
                    
                    // Scroll to certificate
                    document.getElementById('certificatePreview').scrollIntoView({behavior: 'smooth'});
                });
        }
        
        function previewCertificate() {
            // Preview with sample data
            document.getElementById('certTitle').textContent = 'Certificate of Completion';
            document.getElementById('certStudentName').textContent = 'John Doe (Sample)';
            document.getElementById('certPerformance').textContent = '92% Average Score';
            document.getElementById('certId').textContent = 'NEET2026-SAMPLE123';
            document.getElementById('certIssuedDate').textContent = new Date().toLocaleDateString();
            
            document.getElementById('certificatePreview').style.display = 'block';
            document.getElementById('certificateStats').style.display = 'none';
        }
        
        function printCertificate() {
            if (!currentSelectedUser) {
                alert('Please generate a certificate first.');
                return;
            }
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>NEET Certificate - ${currentSelectedUser.fullName || currentSelectedUser.username}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
                        .certificate { border: 5px solid gold; padding: 60px; margin: 20px auto; max-width: 800px; 
                            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%); }
                        .title { color: #1e3a8a; font-size: 36px; margin-bottom: 30px; text-transform: uppercase; }
                        .name { color: #3730a3; font-size: 42px; margin: 30px 0; padding: 15px; border-bottom: 3px solid #fbbf24; }
                        .details { background: rgba(255,255,255,0.9); padding: 30px; margin: 30px 0; border-radius: 15px; }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <h1 class="title">${document.getElementById('certTitle').textContent}</h1>
                        <p style="font-size: 20px; color: #4b5563;">This is to certify that</p>
                        <h2 class="name">${currentSelectedUser.fullName || currentSelectedUser.username}</h2>
                        <p style="font-size: 18px; color: #6b7280; line-height: 1.6;">
                            has successfully completed the intensive 82-day NEET preparation program<br>
                            demonstrating exceptional dedication and commitment to academic excellence.
                        </p>
                        <div class="details">
                            <p><strong>Program Duration:</strong> 82 Days (Feb 10 - May 2, 2026)</p>
                            <p><strong>Overall Performance:</strong> ${document.getElementById('certPerformance').textContent}</p>
                            <p><strong>Certificate ID:</strong> ${document.getElementById('certId').textContent}</p>
                            <p><strong>Issued Date:</strong> ${document.getElementById('certIssuedDate').textContent}</p>
                        </div>
                        <div style="margin-top: 40px;">
                            <p style="color: #6b7280;"><strong>Official Seal:</strong> NEET Preparation Portal</p>
                            <p style="color: #6b7280;"><strong>Issuing Authority:</strong> NEET Exam Preparation Committee</p>
                        </div>
                    </div>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }
        
        function downloadCertificate() {
            if (!currentSelectedUser) {
                alert('Please generate a certificate first.');
                return;
            }
            
            const certificateHTML = `
                <html>
                <head>
                    <title>NEET Certificate - ${currentSelectedUser.fullName || currentSelectedUser.username}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
                        .certificate { border: 5px solid gold; padding: 60px; margin: 20px auto; max-width: 800px; 
                            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%); }
                        .title { color: #1e3a8a; font-size: 36px; margin-bottom: 30px; text-transform: uppercase; }
                        .name { color: #3730a3; font-size: 42px; margin: 30px 0; padding: 15px; border-bottom: 3px solid #fbbf24; }
                        .details { background: rgba(255,255,255,0.9); padding: 30px; margin: 30px 0; border-radius: 15px; }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <h1 class="title">${document.getElementById('certTitle').textContent}</h1>
                        <p style="font-size: 20px; color: #4b5563;">This is to certify that</p>
                        <h2 class="name">${currentSelectedUser.fullName || currentSelectedUser.username}</h2>
                        <p style="font-size: 18px; color: #6b7280; line-height: 1.6;">
                            has successfully completed the intensive 82-day NEET preparation program<br>
                            demonstrating exceptional dedication and commitment to academic excellence.
                        </p>
                        <div class="details">
                            <p><strong>Program Duration:</strong> 82 Days (Feb 10 - May 2, 2026)</p>
                            <p><strong>Overall Performance:</strong> ${document.getElementById('certPerformance').textContent}</p>
                            <p><strong>Certificate ID:</strong> ${document.getElementById('certId').textContent}</p>
                            <p><strong>Issued Date:</strong> ${document.getElementById('certIssuedDate').textContent}</p>
                        </div>
                        <div style="margin-top: 40px;">
                            <p style="color: #6b7280;"><strong>Official Seal:</strong> NEET Preparation Portal</p>
                            <p style="color: #6b7280;"><strong>Issuing Authority:</strong> NEET Exam Preparation Committee</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([certificateHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `NEET_Certificate_${currentSelectedUser.username}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function emailCertificate() {
            if (!currentSelectedUser) {
                alert('Please generate a certificate first.');
                return;
            }
            
            const email = prompt('Enter student email address:');
            if (email && validateEmail(email)) {
                alert(`Certificate would be emailed to ${email}\n\n(In production, this would trigger an email API)`);
            } else if (email) {
                alert('Please enter a valid email address.');
            }
        }
        
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        // ========== UTILITY FUNCTIONS ==========
        function goToDayEdit() {
            showTab('upload');
            loadDayQuestions(currentSelectedDay);
        }
        
        // Search functionality
        document.getElementById('searchUser').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const rows = document.querySelectorAll('#usersTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
