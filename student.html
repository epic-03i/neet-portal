<!DOCTYPE html>
<html>
<head>
    <title>NEET Prep Portal - Student</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ========== ALL CSS IN ONE FILE ========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container { 
            width: 100%;
            max-width: 500px;
            background: white; 
            border-radius: 15px; 
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Auth Screens */
        .auth-container {
            padding: 40px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-icon {
            font-size: 48px;
            color: #3b82f6;
            margin-bottom: 15px;
        }
        
        .auth-title {
            color: #1e293b;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }
        
        .auth-tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 25px;
            padding: 5px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            background: white;
            color: #3b82f6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: #475569;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-btn:hover {
            background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid #fbbf24;
        }
        
        .welcome-message {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .student-id {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .dashboard-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .dashboard-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .dashboard-tab {
            padding: 18px 25px;
            background: #f1f5f9;
            color: #475569;
            cursor: pointer;
            font-weight: 600;
            border-right: 1px solid #e2e8f0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        
        .dashboard-tab:hover {
            background: #e2e8f0;
        }
        
        .dashboard-tab.active {
            background: white;
            color: #1e40af;
            border-bottom-color: #3b82f6;
        }
        
        .dashboard-content {
            padding: 25px;
            min-height: 400px;
        }
        
        /* Progress Dashboard */
        .progress-circle {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            position: relative;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            fill: none;
            stroke-width: 8;
        }
        
        .progress-ring-bg {
            stroke: #e5e7eb;
        }
        
        .progress-ring-fill {
            stroke: #10b981;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .progress-percent {
            font-size: 32px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .progress-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .day-progress {
            margin: 30px 0;
        }
        
        .day-progress-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1f2937;
        }
        
        .day-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 8px;
        }
        
        .day-cell {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .day-cell.completed {
            background: #10b981;
            color: white;
        }
        
        .day-cell.current {
            background: #f59e0b;
            color: white;
        }
        
        .day-cell.available {
            background: #3b82f6;
            color: white;
        }
        
        .day-cell.locked {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .test-history {
            margin-top: 30px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .history-table th {
            background: #4f46e5;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .history-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        /* Certificate */
        .certificate-preview {
            border: 3px solid gold;
            padding: 30px;
            border-radius: 15px;
            background: white;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
        }
        
        .certificate-title {
            color: #1e3a8a;
            font-size: 28px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .certificate-name {
            color: #3730a3;
            font-size: 32px;
            margin: 20px 0;
            padding: 10px;
            border-bottom: 2px solid #fbbf24;
        }
        
        /* Test Interface */
        .test-interface {
            display: none;
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .test-header {
            background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .timer {
            background: #ef4444;
            color: white;
            padding: 12px;
            font-size: 24px;
            text-align: center;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .question-container {
            padding: 20px;
            min-height: 400px;
        }
        
        .question {
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            color: #1f2937;
            line-height: 1.5;
        }
        
        .options {
            display: grid;
            gap: 10px;
        }
        
        .option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .option.selected {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .option.wrong {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .option-label {
            width: 30px;
            height: 30px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .option.selected .option-label {
            background: #10b981;
            color: white;
        }
        
        .option.correct .option-label {
            background: #10b981;
            color: white;
        }
        
        .option.wrong .option-label {
            background: #ef4444;
            color: white;
        }
        
        .test-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .test-btn {
            padding: 12px 25px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .test-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-btn.submit {
            background: #10b981;
        }
        
        .test-btn.submit:hover {
            background: #059669;
        }
        
        .test-btn.warning {
            background: #f59e0b;
        }
        
        .test-btn.warning:hover {
            background: #d97706;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* Test Day Info */
        .test-info {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4f46e5;
        }
        
        .test-day-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .test-detail {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .test-detail-label {
            color: #64748b;
            font-size: 14px;
        }
        
        .test-detail-value {
            font-weight: 600;
            color: #1e293b;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #10b981 100%);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Result Screen */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .result-icon.pass {
            color: #10b981;
        }
        
        .result-icon.fail {
            color: #ef4444;
        }
        
        .result-score {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
            color: #1f2937;
        }
        
        .result-message {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 30px;
        }
        
        .result-details {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border: 1px solid #e2e8f0;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-stat {
            text-align: center;
            padding: 15px;
        }
        
        .result-stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-stat-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        /* Review Screen */
        .review-container {
            padding: 20px;
        }
        
        .review-question {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .review-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .review-status.correct {
            background: #d1fae5;
            color: #065f46;
        }
        
        .review-status.incorrect {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .explanation {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .review-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Submit Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width : 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-title {
            color: #1e293b;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .modal-message {
            color: #64748b;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .modal-btn.primary {
            background: #3b82f6;
            color: white;
        }
        
        .modal-btn.primary:hover {
            background: #2563eb;
        }
        
        .modal-btn.secondary {
            background: #e2e8f0;
            color: #475569;
        }
        
        .modal-btn.secondary:hover {
            background: #cbd5e1;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                margin: 10px;
            }
            
            .auth-container {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .day-grid {
                grid-template-columns: repeat(auto-fill, minmax(35px, 1fr));
            }
            
            .day-cell {
                width: 35px;
                height: 35px;
                font-size: 12px;
            }
            
            .test-interface {
                max-width: 100%;
            }
            
            .result-stats {
                grid-template-columns: 1fr;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
        }

        /* ========== NEET COUNTDOWN TIMER STYLES ========== */
        .neet-countdown-card {
            animation: pulse 2s infinite;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            border: 2px solid #fbbf24;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        .countdown-unit {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .countdown-unit:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .countdown-value {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .countdown-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.9);
            margin-top: 5px;
        }

        /* Critical time warnings */
        .countdown-critical .countdown-value {
            color: #ef4444;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* For the header countdown */
        #neetCountdown {
            transition: all 0.3s ease;
        }

        #neetCountdown:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        /* Responsive adjustments for countdown */
        @media (max-width: 768px) {
            .countdown-value {
                font-size: 24px;
            }
            
            .countdown-unit {
                padding: 8px;
            }
            
            #neetCountdown {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            #countdownTimer {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screens -->
    <div id="authScreen" class="container">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-icon">üéì</div>
                <h1 class="auth-title">NEET Preparation Portal</h1>
                <p class="auth-subtitle">82 Days ‚Ä¢ 30 Questions Daily ‚Ä¢ Track Your Progress</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthTab('login')">Login</div>
                <div class="auth-tab" onclick="showAuthTab('register')">Register</div>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="loginUsername" class="form-input" placeholder="Enter your username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
                </div>
                
                <button onclick="loginUser()" class="auth-btn">üîê Login to Dashboard</button>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="regFullName" class="form-input" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="regUsername" class="form-input" placeholder="Choose a username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="regPassword" class="form-input" placeholder="Choose a password (min 6 chars)">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" id="regConfirmPassword" class="form-input" placeholder="Confirm your password">
                </div>
                
                <button onclick="registerUser()" class="auth-btn">üöÄ Create Account</button>
            </div>
            
            <div style="margin-top: 20px; text-align: center; color: #64748b; font-size: 14px;">
                <p>Track your 82-day journey with detailed analytics and certificates</p>
            </div>
        </div>
    </div>
    
    <!-- Dashboard -->
    <div id="dashboard" class="container" style="display: none;">
        <button onclick="logoutUser()" class="logout-btn">üëã Logout</button>
        
        <div class="dashboard-header">
            <div class="welcome-message" id="welcomeMessage">Welcome, Student!</div>
            <div class="student-id" id="studentId">ID: Loading...</div>
            
            <!-- NEET Countdown Timer -->
            <div id="neetCountdown" style="
                background: rgba(255,255,255,0.15);
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 14px;
                margin-top: 15px;
                display: inline-block;
                font-weight: 500;
                backdrop-filter: blur(10px);">

                <span style="margin-right: 10px;">‚è≥</span>
                <span id="countdownText">NEET 2026: Loading...</span>
            </div>
        </div>
        
        <div class="dashboard-tabs">
            <div class="dashboard-tab active" onclick="showDashboardTab('progress')">
                üìä Progress
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('tests')">
                üìù Take Test
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('history')">
                üìà History
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('certificate')">
                üèÜ Certificate
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('profile')">
                üë§ Profile
            </div>
        </div>
        
        <!-- Progress Tab -->
        <div id="progressTab" class="dashboard-content">
            <div class="progress-circle">
                <svg class="progress-ring" width="150" height="150">
                    <circle class="progress-ring-bg" cx="75" cy="75" r="65" stroke-width="8"></circle>
                    <circle class="progress-ring-fill" cx="75" cy="75" r="65" stroke-width="8"></circle>
                </svg>
                <div class="progress-text">
                    <div class="progress-percent" id="progressPercent">0%</div>
                    <div class="progress-label">Overall Progress</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="completedDays">0</div>
                    <div class="stat-label">Days Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgScore">0%</div>
                    <div class="stat-label">Avg Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Tests Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="streakDays">0</div>
                    <div class="stat-label">Day Streak</div>
                </div>
            </div>

            <!-- NEET Countdown Card -->
            <div class="neet-countdown-card">
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                    <div style="font-size: 24px;">‚è∞</div>
                    <h3 style="color: white; margin: 0;">NEET 2026 Countdown</h3>
                </div>
                
                <div id="countdownTimer" style="
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 15px;
                    margin: 20px 0;
                ">
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-days">00</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-hours">00</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-minutes">00</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-seconds">00</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                </div>
                
                <div id="motivationMessage" style="
                    font-size: 16px;
                    font-weight: 600;
                    margin-top: 15px;
                    padding: 10px;
                    background: rgba(255,255,255,0.15);
                    border-radius: 8px;
                    border-left: 4px solid #fbbf24;
                ">
                    Loading motivation message...
                </div>
                
                <div style="
                    background: rgba(255,255,255,0.2);
                    padding: 10px;
                    border-radius: 8px;
                    font-size: 14px;
                    margin-top: 15px;
                ">
                    <span style="font-weight: bold;">üìÖ Exam Date:</span> May 3, 2026 (Sunday)
                </div>
            </div>
            
            <div class="day-progress">
                <h3 class="day-progress-title">82-Day Progress</h3>
                <div class="day-grid" id="dayProgressGrid">
                    <!-- Days will be populated -->
                </div>
            </div>
        </div>
        
        <!-- Tests Tab -->
        <div id="testsTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Select Day for Test</h2>
            <p style="color: #64748b; margin-bottom: 25px;">Each test has 30 questions with 30-minute time limit</p> <!-- CHANGED -->
            
            <div class="day-grid" id="testDaySelector">
                <!-- Days will be populated -->
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="historyTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Test History</h2>
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Day</th>
                        <th>Topic</th>
                        <th>Date</th>
                        <th>Score</th>
                        <th>Percentage</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <!-- History will be populated -->
                </tbody>
            </table>
        </div>
        
        <!-- Certificate Tab -->
        <div id="certificateTab" class="dashboard-content" style="display: none;">
            <div id="certificateDisplay">
                <h2 style="color: #1e293b; margin-bottom: 20px;">Your Certificate</h2>
                <div id="certificateContent" style="display: none;">
                    <!-- Certificate will be displayed here -->
                </div>
                <div id="noCertificate" style="padding: 40px; color: #6b7280; text-align: center;">
                    <p style="font-size: 18px; margin-bottom: 20px;">Complete all 82 days to unlock your certificate!</p>
                    <div class="progress-circle" style="width: 120px; height: 120px; margin: 20px auto;">
                        <svg class="progress-ring" width="120" height="120">
                            <circle class="progress-ring-bg" cx="60" cy="60" r="52" stroke-width="8"></circle>
                            <circle class="progress-ring-fill" id="certProgressRing" cx="60" cy="60" r="52" stroke-width="8"></circle>
                        </svg>
                        <div class="progress-text">
                            <div class="progress-percent" id="certProgressPercent">0%</div>
                        </div>
                    </div>
                    <p id="daysRemaining">82 days remaining</p>
                </div>
                
                <div id="progressCertificate" style="display: none; margin-top: 30px;">
                    <div class="certificate-preview">
                        <h3 class="certificate-title">Progress Certificate</h3>
                        <p>You have completed <strong id="progressDays">0</strong> out of 82 days</p>
                        <p>Keep going! You're making great progress!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Tab -->
        <div id="profileTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 25px;">Your Profile</h2>
            
            <div style="background: #f8fafc; padding: 25px; border-radius: 10px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Full Name</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileName">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Username</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileUsername">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Student ID</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileId">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Joined Date</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileJoined">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Current Day</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileCurrentDay">Day 1</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <h3 style="color: #1e293b; margin-bottom: 15px;">Account Security</h3>
                    <button onclick="changePassword()" style="padding: 12px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                        üîê Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Interface -->
    <div id="testInterface" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2 id="testDayTitle">Day 1 Test</h2>
            <p id="testTopic">Plant Growth Hormones (Easy)</p>
        </div>
        
        <div class="timer" id="testTimer">30:00</div> <!-- CHANGED -->
        
        <div class="question-container">
            <div class="test-info" id="testDayInfo">
                <!-- Test day info will be populated here -->
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="testProgressBar" style="width: 0%"></div>
            </div>
            
            <div id="questionDisplay">
                <!-- Questions will be loaded here -->
            </div>
            
            <div class="test-controls">
                <button id="prevBtn" class="test-btn" onclick="prevQuestion()" disabled>‚¨Ö Previous</button>
                <div>
                    <span id="questionCounter">Question 1/30</span>
                </div>
                <button id="nextBtn" class="test-btn" onclick="nextQuestion()">Next ‚û°</button>
                <button id="submitBtn" class="test-btn submit" onclick="showSubmitConfirmation()" style="display: none;">Submit Test</button>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2>Test Results</h2>
            <p>Day <span id="resultDay">1</span> ‚Ä¢ <span id="resultTopic">Topic</span></p>
        </div>
        
        <div class="question-container">
            <div class="result-container">
                <div class="result-icon pass" id="resultIcon">üéØ</div>
                <div class="result-score" id="finalScore">0/30</div>
                <div class="result-message" id="resultMessage"></div>
                
                <div class="result-details">
                    <h3 style="color: #1e293b; margin-bottom: 20px;">Performance Summary</h3>
                    <div class="result-stats">
                        <div class="result-stat">
                            <div class="result-stat-value" id="correctAnswers">0</div>
                            <div class="result-stat-label">Correct Answers</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="wrongAnswers">0</div>
                            <div class="result-stat-label">Wrong Answers</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="percentageScore">0%</div>
                            <div class="result-stat-label">Percentage</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="timeTaken">0:00</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                    <button onclick="backToDashboard()" class="test-btn">üìä Back to Dashboard</button>
                    <button onclick="showReviewScreen()" class="test-btn warning">üìù Review Answers</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Screen -->
    <div id="reviewScreen" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2>Test Review</h2>
            <p>Day <span id="reviewDay">1</span> ‚Ä¢ <span id="reviewTopic">Topic</span></p>
        </div>
        
        <div class="question-container">
            <div class="review-container">
                <h3 style="color: #1e293b; margin-bottom: 20px;">Review Your Answers</h3>
                <div id="reviewQuestions">
                    <!-- Review questions will be populated here -->
                </div>
                
                <div class="review-controls">
                    <button onclick="backToResults()" class="test-btn">‚¨Ö Back to Results</button>
                    <button onclick="backToDashboard()" class="test-btn">üìä Back to Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div id="submitModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-title">Submit Test?</div>
            <div class="modal-message">
                Are you sure you want to submit the test?<br>
                You have answered <span id="answeredCount">0</span> out of 30 questions.<br>
                Once submitted, you cannot change your answers.
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="hideSubmitModal()">Cancel</button>
                <button class="modal-btn primary" onclick="submitTest()">Submit Test</button>
            </div>
        </div>
    </div>

    <!-- ========== ALL JAVASCRIPT ========== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDQllntvhYYX2_SgZh7eUna1ZCl1_Pk5iE",
            authDomain: "neet-practise-4x.firebaseapp.com",
            databaseURL: "https://neet-practise-4x-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "neet-practise-4x",
            storageBucket: "neet-practise-4x.firebasestorage.app",
            messagingSenderId: "580564387981",
            appId: "1:580564387981:web:14bca0642e18e2b568bac4",
            measurementId: "G-XN5YWRFQHN"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // ========== GLOBAL VARIABLES ==========
        let currentUser = null;
        let userId = null;
        
        // NEET Schedule Data - Complete 82 days
        const neetSchedule = [
            {day: 1, date: "Tuesday, February 10, 2026", topic: "Plant Growth Hormones", difficulty: "Easy", subject: "Botany"},
            {day: 2, date: "Wednesday, February 11, 2026", topic: "Mineral Nutrition", difficulty: "Medium", subject: "Botany"},
            {day: 3, date: "Thursday, February 12, 2026", topic: "Transport in Plants", difficulty: "Medium", subject: "Botany"},
            {day: 4, date: "Friday, February 13, 2026", topic: "Respiration in Plants", difficulty: "Hard", subject: "Botany"},
            {day: 5, date: "Saturday, February 14, 2026", topic: "Respiration in Plants", difficulty: "Hard", subject: "Botany"},
            {day: 6, date: "Sunday, February 15, 2026", topic: "Photosynthesis", difficulty: "Hard", subject: "Botany"},
            {day: 7, date: "Monday, February 16, 2026", topic: "Photosynthesis", difficulty: "Hard", subject: "Botany"},
            {day: 8, date: "Tuesday, February 17, 2026", topic: "Photosynthesis", difficulty: "Hard", subject: "Botany"},
            {day: 9, date: "Wednesday, February 18, 2026", topic: "Sexual Reproduction (Plants)", difficulty: "Hard", subject: "Botany"},
            {day: 10, date: "Thursday, February 19, 2026", topic: "Sexual Reproduction (Plants)", difficulty: "Hard", subject: "Botany"},
            {day: 11, date: "Friday, February 20, 2026", topic: "Sexual Reproduction (Plants)", difficulty: "Hard", subject: "Botany"},
            {day: 12, date: "Saturday, February 21, 2026", topic: "Botany Revision + NCERT", difficulty: "Revision", subject: "Botany"},
            {day: 13, date: "Sunday, February 22, 2026", topic: "Botany Revision + NCERT", difficulty: "Revision", subject: "Botany"},
            {day: 14, date: "Monday, February 23, 2026", topic: "Botany Revision + NCERT", difficulty: "Revision", subject: "Botany"},
            {day: 15, date: "Tuesday, February 24, 2026", topic: "Botany Revision + NCERT", difficulty: "Revision", subject: "Botany"},
            {day: 16, date: "Wednesday, February 25, 2026", topic: "Ecology", difficulty: "Easy", subject: "Zoology"},
            {day: 17, date: "Thursday, February 26, 2026", topic: "Digestion", difficulty: "Medium", subject: "Zoology"},
            {day: 18, date: "Friday, February 27, 2026", topic: "Breathing & Respiration", difficulty: "Medium", subject: "Zoology"},
            {day: 19, date: "Saturday, February 28, 2026", topic: "Excretion", difficulty: "Medium", subject: "Zoology"},
            {day: 20, date: "Sunday, March 1, 2026", topic: "Circulation", difficulty: "Hard", subject: "Zoology"},
            {day: 21, date: "Monday, March 2, 2026", topic: "Circulation", difficulty: "Hard", subject: "Zoology"},
            {day: 22, date: "Tuesday, March 3, 2026", topic: "Endocrine System", difficulty: "Hard", subject: "Zoology"},
            {day: 23, date: "Wednesday, March 4, 2026", topic: "Neural Control", difficulty: "Hard", subject: "Zoology"},
            {day: 24, date: "Thursday, March 5, 2026", topic: "Neural Control", difficulty: "Hard", subject: "Zoology"},
            {day: 25, date: "Friday, March 6, 2026", topic: "Reproduction (Humans)", difficulty: "Hard", subject: "Zoology"},
            {day: 26, date: "Saturday, March 7, 2026", topic: "Reproduction (Humans)", difficulty: "Hard", subject: "Zoology"},
            {day: 27, date: "Sunday, March 8, 2026", topic: "Zoology Revision + PYQs", difficulty: "Revision", subject: "Zoology"},
            {day: 28, date: "Monday, March 9, 2026", topic: "Zoology Revision + PYQs", difficulty: "Revision", subject: "Zoology"},
            {day: 29, date: "Tuesday, March 10, 2026", topic: "Zoology Revision + PYQs", difficulty: "Revision", subject: "Zoology"},
            {day: 30, date: "Wednesday, March 11, 2026", topic: "Zoology Revision + PYQs", difficulty: "Revision", subject: "Zoology"},
            {day: 31, date: "Thursday, March 12, 2026", topic: "Periodic Trends", difficulty: "Easy", subject: "Inorganic Chemistry"},
            {day: 32, date: "Friday, March 13, 2026", topic: "p-Block", difficulty: "Medium", subject: "Inorganic Chemistry"},
            {day: 33, date: "Saturday, March 14, 2026", topic: "d & f Block", difficulty: "Medium", subject: "Inorganic Chemistry"},
            {day: 34, date: "Sunday, March 15, 2026", topic: "Chemical Bonding", difficulty: "Hard", subject: "Inorganic Chemistry"},
            {day: 35, date: "Monday, March 16, 2026", topic: "Chemical Bonding", difficulty: "Hard", subject: "Inorganic Chemistry"},
            {day: 36, date: "Tuesday, March 17, 2026", topic: "Coordination Compounds", difficulty: "Hard", subject: "Inorganic Chemistry"},
            {day: 37, date: "Wednesday, March 18, 2026", topic: "Coordination Compounds", difficulty: "Hard", subject: "Inorganic Chemistry"},
            {day: 38, date: "Thursday, March 19, 2026", topic: "Inorganic NCERT Revision", difficulty: "Revision", subject: "Inorganic Chemistry"},
            {day: 39, date: "Friday, March 20, 2026", topic: "Biomolecules", difficulty: "Easy", subject: "Organic Chemistry"},
            {day: 40, date: "Saturday, March 21, 2026", topic: "Hydrocarbons", difficulty: "Medium", subject: "Organic Chemistry"},
            {day: 41, date: "Sunday, March 22, 2026", topic: "Haloalkanes", difficulty: "Medium", subject: "Organic Chemistry"},
            {day: 42, date: "Monday, March 23, 2026", topic: "Alcohols & Phenols", difficulty: "Medium", subject: "Organic Chemistry"},
            {day: 43, date: "Tuesday, March 24, 2026", topic: "Carbonyl Compounds", difficulty: "Hard", subject: "Organic Chemistry"},
            {day: 44, date: "Wednesday, March 25, 2026", topic: "Carbonyl Compounds", difficulty: "Hard", subject: "Organic Chemistry"},
            {day: 45, date: "Thursday, March 26, 2026", topic: "Amines", difficulty: "Hard", subject: "Organic Chemistry"},
            {day: 46, date: "Friday, March 27, 2026", topic: "GOC", difficulty: "Hard", subject: "Organic Chemistry"},
            {day: 47, date: "Saturday, March 28, 2026", topic: "GOC", difficulty: "Hard", subject: "Organic Chemistry"},
            {day: 48, date: "Sunday, March 29, 2026", topic: "Organic Revision + PYQs", difficulty: "Revision", subject: "Organic Chemistry"},
            {day: 49, date: "Monday, March 30, 2026", topic: "Gaseous State", difficulty: "Easy", subject: "Physical Chemistry"},
            {day: 50, date: "Tuesday, March 31, 2026", topic: "Solutions", difficulty: "Medium", subject: "Physical Chemistry"},
            {day: 51, date: "Wednesday, April 1, 2026", topic: "Chemical Kinetics", difficulty: "Medium", subject: "Physical Chemistry"},
            {day: 52, date: "Thursday, April 2, 2026", topic: "Chemical Kinetics", difficulty: "Medium", subject: "Physical Chemistry"},
            {day: 53, date: "Friday, April 3, 2026", topic: "Electrochemistry", difficulty: "Hard", subject: "Physical Chemistry"},
            {day: 54, date: "Saturday, April 4, 2026", topic: "Electrochemistry", difficulty: "Hard", subject: "Physical Chemistry"},
            {day: 55, date: "Sunday, April 5, 2026", topic: "Thermodynamics", difficulty: "Hard", subject: "Physical Chemistry"},
            {day: 56, date: "Monday, April 6, 2026", topic: "Thermodynamics", difficulty: "Hard", subject: "Physical Chemistry"},
            {day: 57, date: "Tuesday, April 7, 2026", topic: "Physical Chem PYQs", difficulty: "Revision", subject: "Physical Chemistry"},
            {day: 58, date: "Wednesday, April 8, 2026", topic: "Physical Chem Revision", difficulty: "Revision", subject: "Physical Chemistry"},
            {day: 59, date: "Thursday, April 9, 2026", topic: "Gravitation", difficulty: "Easy", subject: "Physics (Mechanics)"},
            {day: 60, date: "Friday, April 10, 2026", topic: "Laws of Motion", difficulty: "Easy-Medium", subject: "Physics (Mechanics)"},
            {day: 61, date: "Saturday, April 11, 2026", topic: "Work-Energy-Power", difficulty: "Medium", subject: "Physics (Mechanics)"},
            {day: 62, date: "Sunday, April 12, 2026", topic: "Centre of Mass", difficulty: "Medium-Hard", subject: "Physics (Mechanics)"},
            {day: 63, date: "Monday, April 13, 2026", topic: "Collisions", difficulty: "Hard", subject: "Physics (Mechanics)"},
            {day: 64, date: "Tuesday, April 14, 2026", topic: "Circular Motion", difficulty: "Hard", subject: "Physics (Mechanics)"},
            {day: 65, date: "Wednesday, April 15, 2026", topic: "Mechanics PYQs", difficulty: "Revision", subject: "Physics (Mechanics)"},
            {day: 66, date: "Thursday, April 16, 2026", topic: "Current Electricity", difficulty: "Easy", subject: "Electricity & Magnetism"},
            {day: 67, date: "Friday, April 17, 2026", topic: "Capacitors", difficulty: "Medium", subject: "Electricity & Magnetism"},
            {day: 68, date: "Saturday, April 18, 2026", topic: "Magnetic Effects", difficulty: "Medium", subject: "Electricity & Magnetism"},
            {day: 69, date: "Sunday, April 19, 2026", topic: "EMI", difficulty: "Hard", subject: "Electricity & Magnetism"},
            {day: 70, date: "Monday, April 20, 2026", topic: "AC Circuits", difficulty: "Hard", subject: "Electricity & Magnetism"},
            {day: 71, date: "Tuesday, April 21, 2026", topic: "Semiconductors / Atoms / Nuclei", difficulty: "Easy", subject: "Optics & Modern Physics"},
            {day: 72, date: "Wednesday, April 22, 2026", topic: "Photoelectric Effect", difficulty: "Medium", subject: "Optics & Modern Physics"},
            {day: 73, date: "Thursday, April 23, 2026", topic: "Ray Optics", difficulty: "Medium", subject: "Optics & Modern Physics"},
            {day: 74, date: "Friday, April 24, 2026", topic: "YDSE", difficulty: "Hard", subject: "Optics & Modern Physics"},
            {day: 75, date: "Saturday, April 25, 2026", topic: "Chemistry full revision", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 76, date: "Sunday, April 26, 2026", topic: "Chemistry full revision", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 77, date: "Monday, April 27, 2026", topic: "Biology NCERT diagrams + tables", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 78, date: "Tuesday, April 28, 2026", topic: "Biology NCERT diagrams + tables", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 79, date: "Wednesday, April 29, 2026", topic: "Physics formula + weak topics", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 80, date: "Thursday, April 30, 2026", topic: "Full NEET Mock + analysis", difficulty: "Mock", subject: "FINAL REVISION"},
            {day: 81, date: "Friday, May 1, 2026", topic: "Weak areas revision", difficulty: "Revision", subject: "FINAL REVISION"},
            {day: 82, date: "Saturday, May 2, 2026", topic: "Light revision + rest", difficulty: "Revision", subject: "FINAL REVISION"}
        ];
        
        // Test Variables
        let currentTestDay = 0;
        let testQuestions = [];
        let currentQuestionIndex = 0;
        let testTimer = null;
        let timeRemaining = 30 * 60; // CHANGED: 30 minutes instead of 60
        let userAnswers = {};
        let testStartTime = null;
        let testEndTime = null;
        let testResults = null;
        
        // ========== AUTHENTICATION ==========
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('loginForm').style.display = 'block';
            } else {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('registerForm').style.display = 'block';
            }
        }
        
        function registerUser() {
            const fullName = document.getElementById('regFullName').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (!fullName || !username || !password) {
                alert('Please fill all fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        alert('Username already exists. Please choose another.');
                        return;
                    }
                    
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const userData = {
                        fullName: fullName,
                        username: username,
                        password: password,
                        createdAt: new Date().toISOString(),
                        lastActive: new Date().toISOString(),
                        currentDay: 1,
                        completedDays: [],
                        scores: {}
                    };
                    
                    database.ref('users/' + userId).set(userData)
                        .then(() => {
                            alert('‚úÖ Registration successful! Please login.');
                            showAuthTab('login');
                            document.getElementById('loginUsername').value = username;
                            document.getElementById('loginPassword').value = '';
                            
                            document.getElementById('regFullName').value = '';
                            document.getElementById('regUsername').value = '';
                            document.getElementById('regPassword').value = '';
                            document.getElementById('regConfirmPassword').value = '';
                        })
                        .catch(error => {
                            alert('Registration failed: ' + error.message);
                        });
                });
        }
        
        function loginUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }
            
            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        alert('Username not found');
                        return;
                    }
                    
                    const users = snapshot.val();
                    let foundUser = null;
                    let foundUserId = null;
                    
                    Object.entries(users).forEach(([id, user]) => {
                        if (user.password === password) {
                            foundUser = user;
                            foundUserId = id;
                        }
                    });
                    
                    if (!foundUser) {
                        alert('Incorrect password');
                        return;
                    }
                    
                    currentUser = foundUser;
                    userId = foundUserId;
                    
                    database.ref('users/' + userId + '/lastActive').set(new Date().toISOString());
                    
                    document.getElementById('authScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    
                    updateDashboard();
                    
                    localStorage.setItem('neetUserId', userId);
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                })
                .catch(error => {
                    alert('Login failed: ' + error.message);
                });
        }
        
        function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                userId = null;
                localStorage.removeItem('neetUserId');
                localStorage.removeItem('neetUserData');
                
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('authScreen').style.display = 'flex';
                
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                showAuthTab('login');
            }
        }
        
        function changePassword() {
            const newPassword = prompt('Enter new password (min 6 characters):');
            if (!newPassword || newPassword.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            database.ref('users/' + userId + '/password').set(newPassword)
                .then(() => {
                    alert('‚úÖ Password changed successfully!');
                    currentUser.password = newPassword;
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                })
                .catch(error => {
                    alert('Error changing password: ' + error.message);
                });
        }
        
        // ========== NEET COUNTDOWN TIMER ==========
        function startNEETCountdown() {
            // NEET 2026 exam date: May 3, 2026 at 10:00 AM
            const neetExamDate = new Date('May 3, 2026 10:00:00').getTime();
            
            function updateCountdown() {
                const now = new Date().getTime();
                const timeRemaining = neetExamDate - now;
                
                if (timeRemaining < 0) {
                    // Exam has passed
                    document.getElementById('countdownText').innerHTML = '<span style="color: #10b981;">üéâ NEET 2026 Completed!</span>';
                    document.getElementById('countdownTimer').innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üéä</div>
                            <h3 style="color: white; margin: 0; font-size: 24px;">Congratulations!</h3>
                            <p style="opacity: 0.9; margin-top: 10px; font-size: 16px;">NEET 2026 has been completed.</p>
                            <p style="opacity: 0.8; margin-top: 5px;">Best wishes for your results! üôè</p>
                        </div>
                    `;
                    
                    document.getElementById('motivationMessage').innerHTML = 
                        'üéì Your hard work will pay off! Results coming soon!';
                    
                    return;
                }
                
                // Calculate time units
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
                
                // Update header countdown
                const headerText = `NEET 2026: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                document.getElementById('countdownText').textContent = headerText;
                
                // Update detailed countdown
                document.getElementById('countdown-days').textContent = days.toString().padStart(2, '0');
                document.getElementById('countdown-hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('countdown-minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('countdown-seconds').textContent = seconds.toString().padStart(2, '0');
                
                // Add critical warning if less than 24 hours
                if (days === 0) {
                    document.getElementById('countdownTimer').classList.add('countdown-critical');
                    document.getElementById('countdownText').style.color = '#ef4444';
                } else {
                    document.getElementById('countdownTimer').classList.remove('countdown-critical');
                    document.getElementById('countdownText').style.color = 'white';
                }
                
                // Update motivation message
                updateMotivationMessage(days);
            }
            
            // Update immediately and then every second
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
        
        function updateMotivationMessage(days) {
            const messages = [
                { threshold: 0, message: "Exam day! Give your best! üí™", color: "#ef4444" },
                { threshold: 1, message: "Final day! Stay focused! üéØ", color: "#f59e0b" },
                { threshold: 7, message: "Final week! Intensive revision! üìö", color: "#f59e0b" },
                { threshold: 30, message: "One month to go! Stay consistent! ‚è≥", color: "#3b82f6" },
                { threshold: 60, message: "Two months remaining! Keep pushing! üî•", color: "#3b82f6" },
                { threshold: 90, message: "Three months to NEET! You can do it! ‚ú®", color: "#10b981" },
                { threshold: 120, message: "Four months left! Stay motivated! üåü", color: "#10b981" },
                { threshold: 150, message: "Five months remaining! Daily practice is key! üìÖ", color: "#10b981" },
                { threshold: 180, message: "Six months to go! Build strong foundations! üèóÔ∏è", color: "#8b5cf6" },
                { threshold: 240, message: "Eight months left! Enjoy the learning journey! üìö", color: "#8b5cf6" },
                { threshold: 300, message: "Ten months remaining! Start with basics! üåü", color: "#8b5cf6" },
                { threshold: 365, message: "One year to NEET! Perfect time to begin! üöÄ", color: "#8b5cf6" }
            ];
            
            // Default message if no threshold matches
            let currentMessage = "Your NEET journey continues! Stay dedicated! üéì";
            let messageColor = "#8b5cf6";
            
            // Find the appropriate message
            for (const msg of messages) {
                if (days <= msg.threshold) {
                    currentMessage = msg.message;
                    messageColor = msg.color;
                    break;
                }
            }
            
            // Add random variation for same threshold days
            const sameThresholdMsgs = messages.filter(m => m.threshold === messages.find(msg => days <= msg.threshold)?.threshold);
            if (sameThresholdMsgs.length > 1) {
                const randomMsg = sameThresholdMsgs[Math.floor(Math.random() * sameThresholdMsgs.length)];
                currentMessage = randomMsg.message;
                messageColor = randomMsg.color;
            }
            
            const motivationEl = document.getElementById('motivationMessage');
            if (motivationEl) {
                motivationEl.innerHTML = currentMessage;
                motivationEl.style.color = messageColor;
                motivationEl.style.fontWeight = '600';
            }
        }
        
        // ========== DASHBOARD FUNCTIONS ==========
        function updateDashboard() {
            if (!currentUser || !userId) return;
            
            // Start the countdown timer
            startNEETCountdown();
            
            document.getElementById('welcomeMessage').textContent = `Welcome, ${currentUser.fullName || currentUser.username}!`;
            document.getElementById('studentId').textContent = `ID: ${userId.substring(0, 8)}`;
            
            document.getElementById('profileName').textContent = currentUser.fullName || 'N/A';
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('profileId').textContent = userId.substring(0, 8);
            document.getElementById('profileJoined').textContent = new Date(currentUser.createdAt).toLocaleDateString();
            document.getElementById('profileCurrentDay').textContent = `Day ${currentUser.currentDay || 1}`;
            
            const completedDays = currentUser.completedDays || [];
            const totalDays = 82;
            const progressPercent = Math.round((completedDays.length / totalDays) * 100);
            
            const circle = document.querySelector('.progress-ring-fill');
            const radius = 65;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progressPercent / 100) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
            
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
            document.getElementById('completedDays').textContent = completedDays.length;
            
            let totalScore = 0;
            let totalTests = 0;
            
            if (currentUser.scores) {
                Object.values(currentUser.scores).forEach(score => {
                    totalScore += (score.score / score.total) * 100;
                    totalTests++;
                });
            }
            
            const avgScore = totalTests > 0 ? Math.round(totalScore / totalTests) : 0;
            document.getElementById('avgScore').textContent = `${avgScore}%`;
            document.getElementById('totalTests').textContent = totalTests;
            
            const streak = completedDays.length > 0 ? Math.min(completedDays.length, 7) : 0;
            document.getElementById('streakDays').textContent = streak;
            
            updateDayProgressGrid(completedDays, currentUser.currentDay);
            updateTestDaySelector(completedDays, currentUser.currentDay);
            updateHistoryTable(currentUser.scores || {});
            updateCertificateProgress(completedDays.length);
        }
        
        function updateDayProgressGrid(completedDays, currentDay) {
            const grid = document.getElementById('dayProgressGrid');
            grid.innerHTML = '';
            
            for (let day = 1; day <= 82; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell locked';
                dayCell.textContent = day;
                dayCell.title = `Day ${day}`;
                
                if (neetSchedule.find(d => d.day === day)) {
                    if (completedDays.includes(day)) {
                        dayCell.className = 'day-cell completed';
                        dayCell.title = `Day ${day}: Completed`;
                    } else if (day === currentDay) {
                        dayCell.className = 'day-cell current';
                        dayCell.title = `Day ${day}: Current`;
                    } else if (day < currentDay) {
                        dayCell.className = 'day-cell available';
                        dayCell.title = `Day ${day}: Available`;
                    }
                }
                
                dayCell.onclick = () => {
                    if (dayCell.classList.contains('locked')) return;
                    
                    if (completedDays.includes(day)) {
                        if (confirm(`You've already completed Day ${day}. Do you want to retake it?`)) {
                            startTest(day);
                        }
                    } else {
                        startTest(day);
                    }
                };
                
                grid.appendChild(dayCell);
            }
        }
        
        function updateTestDaySelector(completedDays, currentDay) {
            const selector = document.getElementById('testDaySelector');
            selector.innerHTML = '';
            
            for (let day = 1; day <= 82; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'day-cell locked';
                dayCell.textContent = day;
                dayCell.title = `Day ${day}`;
                
                if (neetSchedule.find(d => d.day === day) && day <= currentDay) {
                    dayCell.className = 'day-cell available';
                    dayCell.title = `Day ${day}: Available`;
                }
                
                dayCell.onclick = () => {
                    if (!dayCell.classList.contains('locked')) {
                        startTest(day);
                    }
                };
                
                selector.appendChild(dayCell);
            }
        }
        
        function updateHistoryTable(scores) {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            
            if (Object.keys(scores).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                            No tests taken yet. Start your first test!
                        </td>
                    </tr>
                `;
                return;
            }
            
            Object.entries(scores).forEach(([dayKey, score]) => {
                const dayNum = parseInt(dayKey.replace('day', ''));
                const dayInfo = neetSchedule.find(d => d.day === dayNum) || {topic: `Day ${dayNum}`};
                
                const percentage = Math.round((score.score / score.total) * 100);
                const date = new Date(score.dateCompleted);
                const formattedDate = date.toLocaleDateString();
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>Day ${dayNum}</td>
                    <td>${dayInfo.topic}</td>
                    <td>${formattedDate}</td>
                    <td>${score.score}/${score.total}</td>
                    <td style="color: ${percentage >= 80 ? '#10b981' : percentage >= 50 ? '#f59e0b' : '#ef4444'}; font-weight: bold;">
                        ${percentage}%
                    </td>
                    <td>
                        <button onclick="reviewTestFromHistory(${dayNum})" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            Review
                        </button>
                    </td>
                `;
            });
        }
        
        function reviewTestFromHistory(day) {
            const scoreKey = `day${day}`;
            if (currentUser.scores && currentUser.scores[scoreKey]) {
                const testData = currentUser.scores[scoreKey];
                showReviewForCompletedTest(day, testData);
            } else {
                alert('No test data found for this day.');
            }
        }
        
        function updateCertificateProgress(completedDays) {
            const totalDays = 82;
            const progressPercent = Math.round((completedDays / totalDays) * 100);
            const daysRemaining = totalDays - completedDays;
            
            const circle = document.getElementById('certProgressRing');
            if (circle) {
                const radius = 52;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (progressPercent / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
                
                document.getElementById('certProgressPercent').textContent = `${progressPercent}%`;
                document.getElementById('daysRemaining').textContent = `${daysRemaining} days remaining`;
                
                if (completedDays > 0 && completedDays < 82) {
                    document.getElementById('progressCertificate').style.display = 'block';
                    document.getElementById('progressDays').textContent = completedDays;
                    document.getElementById('noCertificate').style.display = 'none';
                } else if (completedDays >= 82) {
                    showFullCertificate();
                }
            }
        }
        
        function showFullCertificate() {
            document.getElementById('noCertificate').style.display = 'none';
            document.getElementById('progressCertificate').style.display = 'none';
            
            const certContent = document.getElementById('certificateContent');
            certContent.style.display = 'block';
            certContent.innerHTML = `
                <div class="certificate-preview">
                    <h1 class="certificate-title">Certificate of Completion</h1>
                    <p style="color: #4b5563; font-size: 18px;">This certifies that</p>
                    <h2 class="certificate-name">${currentUser.fullName || currentUser.username}</h2>
                    <p style="color: #6b7280; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                        has successfully completed the 82-day NEET preparation program
                    </p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button onclick="downloadMyCertificate()" style="padding: 12px 25px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üì• Download Certificate
                        </button>
                        <button onclick="printMyCertificate()" style="padding: 12px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üñ®Ô∏è Print Certificate
                        </button>
                    </div>
                </div>
            `;
        }
        
        function downloadMyCertificate() {
            const certContent = `
                <html>
                <head>
                    <title>NEET Certificate - ${currentUser.fullName || currentUser.username}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 40px; text-align: center; }
                        .certificate { border: 3px solid gold; padding: 40px; margin: 20px auto; max-width: 800px; }
                        .title { color: #1e3a8a; font-size: 32px; margin-bottom: 20px; }
                        .name { color: #3730a3; font-size: 36px; margin: 20px 0; padding: 10px; border-bottom: 2px solid #fbbf24; }
                    </style>
                </head>
                <body>
                    <div class="certificate">
                        <h1 class="title">Certificate of Completion</h1>
                        <p>This certifies that</p>
                        <h2 class="name">${currentUser.fullName || currentUser.username}</h2>
                        <p>has successfully completed the 82-day NEET preparation program</p>
                        <p><strong>Student ID:</strong> ${userId.substring(0, 8)}</p>
                        <p><strong>Date:</strong> ${new Date().toLocaleDateString()}</p>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([certContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `NEET_Certificate_${currentUser.username}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function printMyCertificate() {
            window.print();
        }
        
        function showDashboardTab(tabName) {
            document.querySelectorAll('.dashboard-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.currentTarget.classList.add('active');
        }
        
        // ========== TEST FUNCTIONS ==========
        function startTest(day) {
            currentTestDay = day;
            currentQuestionIndex = 0;
            timeRemaining = 30 * 60; // CHANGED: 30 minutes instead of 60
            userAnswers = {};
            testStartTime = new Date();
            
            const dayInfo = neetSchedule.find(d => d.day === day) || {
                topic: `Day ${day}`,
                difficulty: "Medium",
                subject: "General"
            };
            
            document.getElementById('testDayTitle').textContent = `Day ${day} Test`;
            document.getElementById('testTopic').textContent = dayInfo.topic;
            
            document.getElementById('testDayInfo').innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h3 style="color: #1e293b; margin: 0 0 5px 0;">${dayInfo.topic}</h3>
                        <p style="color: #64748b; margin: 0;">${dayInfo.subject} ‚Ä¢ ${dayInfo.difficulty}</p>
                    </div>
                    <div style="text-align: right;">
                        <p style="color: #64748b; margin: 0;">Date: ${dayInfo.date}</p>
                        <p style="color: #64748b; margin: 0;">Time Limit: 30 minutes</p> <!-- CHANGED -->
                    </div>
                </div>
            `;
            
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('testInterface').style.display = 'block';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'none';
            
            loadQuestionsFromFirebase(day);
        }
        
        // ========== FIXED QUESTION LOADING FUNCTION ==========
        function loadQuestionsFromFirebase(day) {
            console.log(`Loading questions for Day ${day} from Firebase...`);
            
            database.ref(`questions/day${day}`).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const questionsData = snapshot.val();
                        console.log('Raw data from Firebase:', questionsData);
                        
                        // Initialize testQuestions array
                        testQuestions = [];
                        
                        // Check if the data has the structure you provided (with questions array)
                        if (questionsData.questions && Array.isArray(questionsData.questions)) {
                            console.log('Detected JSON structure with questions array');
                            
                            questionsData.questions.forEach((q, index) => {
                                // Convert the options object to array format
                                const optionsArray = [];
                                
                                // Handle options in object format {A: "text", B: "text", C: "text", D: "text"}
                                if (q.options && typeof q.options === 'object') {
                                    Object.entries(q.options).forEach(([key, value]) => {
                                        optionsArray.push({
                                            id: key,
                                            text: value
                                        });
                                    });
                                } else {
                                    // If no options provided, create default options
                                    optionsArray.push(
                                        {id: 'A', text: 'Option A'},
                                        {id: 'B', text: 'Option B'},
                                        {id: 'C', text: 'Option C'},
                                        {id: 'D', text: 'Option D'}
                                    );
                                }
                                
                                // Add the question to testQuestions
                                testQuestions.push({
                                    id: q.id || index + 1,
                                    text: q.question || `Question ${index + 1}`,
                                    options: optionsArray,
                                    correctAnswer: q.answer || 'A',
                                    explanation: q.explanation || 'No explanation available'
                                });
                            });
                            
                            console.log(`Successfully loaded ${testQuestions.length} questions for Day ${day}`);
                            
                            if (testQuestions.length === 0) {
                                showNoQuestionsError(day);
                                return;
                            }
                            
                            loadQuestion();
                            startTestTimer();
                            
                        } else {
                            // Try alternative structure - maybe questions are directly under day
                            console.log('Trying alternative structure...');
                            
                            // Check if there are any direct question objects
                            let hasQuestions = false;
                            Object.keys(questionsData).forEach(key => {
                                if (questionsData[key] && questionsData[key].question) {
                                    hasQuestions = true;
                                }
                            });
                            
                            if (hasQuestions) {
                                // Process each question
                                Object.entries(questionsData).forEach(([key, q]) => {
                                    if (q && q.question) {
                                        const optionsArray = [];
                                        
                                        if (q.options && typeof q.options === 'object') {
                                            Object.entries(q.options).forEach(([optKey, optValue]) => {
                                                optionsArray.push({
                                                    id: optKey,
                                                    text: optValue
                                                });
                                            });
                                        }
                                        
                                        testQuestions.push({
                                            id: q.id || key,
                                            text: q.question,
                                            options: optionsArray,
                                            correctAnswer: q.answer || 'A',
                                            explanation: q.explanation || 'No explanation available'
                                        });
                                    }
                                });
                                
                                console.log(`Loaded ${testQuestions.length} questions from alternative structure`);
                                
                                if (testQuestions.length > 0) {
                                    loadQuestion();
                                    startTestTimer();
                                    return;
                                }
                            }
                            
                            console.log('No questions found in any expected format for Day', day);
                            showNoQuestionsError(day);
                        }
                    } else {
                        console.log(`No questions found for Day ${day} in Firebase`);
                        showNoQuestionsError(day);
                    }
                })
                .catch(error => {
                    console.error('Error loading questions from Firebase:', error);
                    showNoQuestionsError(day);
                });
        }
        
        function showNoQuestionsError(day) {
            alert(`No questions available for Day ${day}. Please contact the admin to add questions.`);
            backToDashboard();
        }
        
        function loadQuestion() {
            if (testQuestions.length === 0) {
                console.error('No questions to load');
                return;
            }
            
            const question = testQuestions[currentQuestionIndex];
            const questionDisplay = document.getElementById('questionDisplay');
            
            const progressPercent = ((currentQuestionIndex + 1) / testQuestions.length) * 100;
            document.getElementById('testProgressBar').style.width = `${progressPercent}%`;
            
            document.getElementById('questionCounter').textContent = `Question ${currentQuestionIndex + 1}/${testQuestions.length}`;
            
            let optionsHTML = '';
            question.options.forEach(option => {
                const isSelected = userAnswers[question.id] === option.id;
                optionsHTML += `
                    <div class="option ${isSelected ? 'selected' : ''}" onclick="selectOption('${option.id}')">
                        <div class="option-label">${option.id}</div>
                        <div class="option-text">${option.text}</div>
                    </div>
                `;
            });
            
            questionDisplay.innerHTML = `
                <div class="question">
                    <div class="question-text">${question.text}</div>
                    <div class="options">${optionsHTML}</div>
                </div>
            `;
            
            // Update button states
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            // Show submit button only on last question
            if (currentQuestionIndex === testQuestions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
        }
        
        function selectOption(optionId) {
            const question = testQuestions[currentQuestionIndex];
            userAnswers[question.id] = optionId;
            loadQuestion();
        }
        
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < testQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }
        
        function showSubmitConfirmation() {
            const answeredCount = Object.keys(userAnswers).length;
            document.getElementById('answeredCount').textContent = answeredCount;
            document.getElementById('submitModal').style.display = 'flex';
        }
        
        function hideSubmitModal() {
            document.getElementById('submitModal').style.display = 'none';
        }
        
        function startTestTimer() {
            updateTimerDisplay();
            testTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(testTimer);
                    submitTest();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('testTimer').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeRemaining <= 300) { // 5 minutes remaining
                document.getElementById('testTimer').style.background = '#dc2626';
            } else if (timeRemaining <= 600) { // 10 minutes remaining
                document.getElementById('testTimer').style.background = '#ea580c';
            }
        }
        
        function submitTest() {
            clearInterval(testTimer);
            hideSubmitModal();
            testEndTime = new Date();
            
            let correct = 0;
            testQuestions.forEach(question => {
                if (userAnswers[question.id] === question.correctAnswer) {
                    correct++;
                }
            });
            
            const totalQuestions = testQuestions.length;
            const percentage = Math.round((correct / totalQuestions) * 100);
            const timeTaken = Math.floor((testEndTime - testStartTime) / 1000);
            
            testResults = {
                day: currentTestDay,
                score: correct,
                total: totalQuestions,
                percentage: percentage,
                timeTaken: timeTaken,
                answers: userAnswers,
                questions: testQuestions,
                dateCompleted: new Date().toISOString()
            };
            
            saveTestResults(testResults);
            showTestResults();
        }
        
        function saveTestResults(results) {
            const scoreData = {
                score: results.score,
                total: results.total,
                percentage: results.percentage,
                dateCompleted: results.dateCompleted,
                timeTaken: results.timeTaken,
                answers: results.answers
            };
            
            const userRef = database.ref('users/' + userId);
            userRef.once('value').then(snapshot => {
                const userData = snapshot.val();
                
                const completedDays = userData.completedDays || [];
                if (!completedDays.includes(currentTestDay)) {
                    completedDays.push(currentTestDay);
                    userData.completedDays = completedDays;
                    
                    if (currentTestDay === userData.currentDay) {
                        userData.currentDay = Math.min(currentTestDay + 1, 82);
                    }
                }
                
                userData.scores = userData.scores || {};
                userData.scores[`day${currentTestDay}`] = scoreData;
                
                userRef.set(userData).then(() => {
                    currentUser = userData;
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                });
            });
        }
        
        function showTestResults() {
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
            
            document.getElementById('resultDay').textContent = currentTestDay;
            const dayInfo = neetSchedule.find(d => d.day === currentTestDay);
            document.getElementById('resultTopic').textContent = dayInfo?.topic || 'Test';
            
            document.getElementById('finalScore').textContent = `${testResults.score}/${testResults.total}`;
            document.getElementById('correctAnswers').textContent = testResults.score;
            document.getElementById('wrongAnswers').textContent = testResults.total - testResults.score;
            document.getElementById('percentageScore').textContent = `${testResults.percentage}%`;
            
            const minutes = Math.floor(testResults.timeTaken / 60);
            const seconds = testResults.timeTaken % 60;
            document.getElementById('timeTaken').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const resultIcon = document.getElementById('resultIcon');
            const resultMessage = document.getElementById('resultMessage');
            
            if (testResults.percentage >= 80) {
                resultIcon.textContent = 'üéâ';
                resultIcon.className = 'result-icon pass';
                resultMessage.textContent = 'Excellent! You aced this test!';
            } else if (testResults.percentage >= 50) {
                resultIcon.textContent = 'üëç';
                resultIcon.className = 'result-icon pass';
                resultMessage.textContent = 'Good job! Keep practicing to improve.';
            } else {
                resultIcon.textContent = 'üìö';
                resultIcon.className = 'result-icon fail';
                resultMessage.textContent = 'Need more practice. Review the concepts and try again.';
            }
        }
        
        function showReviewScreen() {
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'block';
            
            document.getElementById('reviewDay').textContent = currentTestDay;
            const dayInfo = neetSchedule.find(d => d.day === currentTestDay);
            document.getElementById('reviewTopic').textContent = dayInfo?.topic || 'Test';
            
            const reviewContainer = document.getElementById('reviewQuestions');
            reviewContainer.innerHTML = '';
            
            testResults.questions.forEach((question, index) => {
                const userAnswer = testResults.answers[question.id];
                const isCorrect = userAnswer === question.correctAnswer;
                
                let optionsHTML = '';
                question.options.forEach(option => {
                    let optionClass = '';
                    if (option.id === question.correctAnswer) {
                        optionClass = 'correct';
                    } else if (option.id === userAnswer && !isCorrect) {
                        optionClass = 'wrong';
                    } else if (option.id === userAnswer) {
                        optionClass = 'selected';
                    }
                    
                    optionsHTML += `
                        <div class="option ${optionClass}">
                            <div class="option-label">${option.id}</div>
                            <div class="option-text">${option.text}</div>
                        </div>
                    `;
                });
                
                const reviewHTML = `
                    <div class="review-question">
                        <div class="review-status ${isCorrect ? 'correct' : 'incorrect'}">
                            ${isCorrect ? '‚úì Correct' : '‚úó Incorrect'}
                        </div>
                        <div class="question-text">${question.text}</div>
                        <div class="options">${optionsHTML}</div>
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    </div>
                `;
                
                reviewContainer.innerHTML += reviewHTML;
            });
        }
        
        function showReviewForCompletedTest(day, testData) {
            currentTestDay = day;
            
            // Load the questions for review
            loadQuestionsFromFirebase(day);
            
            // Wait for questions to load, then set up review data
            setTimeout(() => {
                if (testQuestions.length === 0) {
                    alert('Cannot review test: Questions not found.');
                    backToDashboard();
                    return;
                }
                
                testResults = {
                    day: day,
                    score: testData.score,
                    total: testData.total,
                    percentage: testData.percentage,
                    timeTaken: testData.timeTaken,
                    answers: testData.answers,
                    questions: testQuestions,
                    dateCompleted: testData.dateCompleted
                };
                
                showReviewScreen();
            }, 500);
        }
        
        function backToResults() {
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
        }
        
        function backToDashboard() {
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            updateDashboard();
            showDashboardTab('progress');
        }
        
        function checkAutoLogin() {
            const savedUserId = localStorage.getItem('neetUserId');
            const savedUserData = localStorage.getItem('neetUserData');
            
            if (savedUserId && savedUserData) {
                database.ref('users/' + savedUserId).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            currentUser = JSON.parse(savedUserData);
                            userId = savedUserId;
                            
                            database.ref('users/' + userId + '/lastActive').set(new Date().toISOString());
                            
                            document.getElementById('authScreen').style.display = 'none';
                            document.getElementById('dashboard').style.display = 'block';
                            updateDashboard();
                        }
                    })
                    .catch(() => {
                        localStorage.removeItem('neetUserId');
                        localStorage.removeItem('neetUserData');
                    });
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            checkAutoLogin();
            showAuthTab('login');
            // Start countdown timer even if not logged in
            startNEETCountdown();
        });
    </script>
</body>
</html>
