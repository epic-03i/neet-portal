<!DOCTYPE html>
<html>
<head>
    <title>NEET Prep Portal - Student (10 Weeks)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        /* ========== ALL CSS IN ONE FILE ========== */
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container { 
            width: 100%;
            max-width: 500px;
            background: white; 
            border-radius: 15px; 
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        /* Auth Screens */
        .auth-container {
            padding: 40px;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-icon {
            font-size: 48px;
            color: #3b82f6;
            margin-bottom: 15px;
        }
        
        .auth-title {
            color: #1e293b;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .auth-subtitle {
            color: #64748b;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .auth-tabs {
            display: flex;
            background: #f1f5f9;
            border-radius: 10px;
            margin-bottom: 25px;
            padding: 5px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            background: white;
            color: #3b82f6;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            color: #475569;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .auth-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .auth-btn:hover {
            background: linear-gradient(90deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
        }
        
        /* Dashboard */
        .dashboard {
            display: none;
            position: relative;
        }
        
        .dashboard-header {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid #fbbf24;
        }
        
        .welcome-message {
            font-size: 20px;
            margin-bottom: 10px;
        }
        
        .student-id {
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }
        
        .dashboard-tabs {
            display: flex;
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            overflow-x: auto;
            scrollbar-width: none;
        }
        
        .dashboard-tabs::-webkit-scrollbar {
            display: none;
        }
        
        .dashboard-tab {
            padding: 18px 25px;
            background: #f1f5f9;
            color: #475569;
            cursor: pointer;
            font-weight: 600;
            border-right: 1px solid #e2e8f0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
        }
        
        .dashboard-tab:hover {
            background: #e2e8f0;
        }
        
        .dashboard-tab.active {
            background: white;
            color: #1e40af;
            border-bottom-color: #3b82f6;
        }
        
        .dashboard-content {
            padding: 25px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        /* Progress Dashboard */
        .progress-circle {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            position: relative;
        }
        
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        .progress-ring-circle {
            fill: none;
            stroke-width: 8;
        }
        
        .progress-ring-bg {
            stroke: #e5e7eb;
        }
        
        .progress-ring-fill {
            stroke: #10b981;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .progress-percent {
            font-size: 32px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .progress-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #4f46e5;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #6b7280;
        }
        
        .week-progress {
            margin: 30px 0;
        }
        
        .week-progress-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1f2937;
        }
        
        .week-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
        }
        
        .week-cell {
            height: 60px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .week-cell.completed {
            background: #10b981;
            color: white;
        }
        
        .week-cell.current {
            background: #f59e0b;
            color: white;
            border-color: #d97706;
        }
        
        .week-cell.available {
            background: #3b82f6;
            color: white;
        }
        
        .week-cell.locked {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .week-number {
            font-size: 16px;
            font-weight: bold;
        }
        
        .week-questions {
            font-size: 10px;
            opacity: 0.9;
        }
        
        .test-history {
            margin-top: 30px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .history-table th {
            background: #4f46e5;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        .history-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 14px;
        }
        
        /* Certificate */
        .certificate-preview {
            border: 3px solid gold;
            padding: 30px;
            border-radius: 15px;
            background: white;
            text-align: center;
            margin: 20px 0;
            background: linear-gradient(135deg, #fdfcfb 0%, #e2d1c3 100%);
        }
        
        .certificate-title {
            color: #1e3a8a;
            font-size: 28px;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .certificate-name {
            color: #3730a3;
            font-size: 32px;
            margin: 20px 0;
            padding: 10px;
            border-bottom: 2px solid #fbbf24;
        }
        
        /* Test Interface */
        .test-interface {
            display: none;
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .test-header {
            background: linear-gradient(90deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .timer {
            background: #ef4444;
            color: white;
            padding: 12px;
            font-size: 24px;
            text-align: center;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        .question-container {
            padding: 20px;
            min-height: 400px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .question {
            margin-bottom: 30px;
        }
        
        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            color: #1f2937;
            line-height: 1.5;
        }
        
        .question-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px solid #e2e8f0;
        }
        
        .options {
            display: grid;
            gap: 12px;
        }
        
        .option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }
        
        .option.selected {
            border-color: #10b981;
            background: #f0fdf4;
        }
        
        .option.correct {
            border-color: #10b981;
            background: #d1fae5;
        }
        
        .option.wrong {
            border-color: #ef4444;
            background: #fee2e2;
        }
        
        .option-label {
            width: 35px;
            height: 35px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .option.selected .option-label {
            background: #10b981;
            color: white;
        }
        
        .option.correct .option-label {
            background: #10b981;
            color: white;
        }
        
        .option.wrong .option-label {
            background: #ef4444;
            color: white;
        }
        
        .option-content {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .option-image {
            max-width: 80px;
            max-height: 50px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
        }
        
        .test-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        .test-btn {
            padding: 12px 25px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .test-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .test-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }
        
        .test-btn.submit {
            background: #10b981;
        }
        
        .test-btn.submit:hover {
            background: #059669;
        }
        
        .test-btn.warning {
            background: #f59e0b;
        }
        
        .test-btn.warning:hover {
            background: #d97706;
        }
        
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            z-index: 100;
        }
        
        .logout-btn:hover {
            background: #dc2626;
        }
        
        /* Test Info */
        .test-info {
            background: #f8fafc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #4f46e5;
        }
        
        .test-day-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .test-detail {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .test-detail-label {
            color: #64748b;
            font-size: 14px;
        }
        
        .test-detail-value {
            font-weight: 600;
            color: #1e293b;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 6px;
            background: #e5e7eb;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #10b981 100%);
            border-radius: 3px;
            transition: width 0.3s;
        }
        
        /* Result Screen */
        .result-container {
            text-align: center;
            padding: 40px 20px;
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }
        
        .result-icon.pass {
            color: #10b981;
        }
        
        .result-icon.fail {
            color: #ef4444;
        }
        
        .result-score {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
            color: #1f2937;
        }
        
        .result-message {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 30px;
        }
        
        .result-details {
            background: #f8fafc;
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border: 1px solid #e2e8f0;
        }
        
        .result-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        
        .result-stat {
            text-align: center;
            padding: 15px;
        }
        
        .result-stat-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .result-stat-label {
            color: #6b7280;
            font-size: 14px;
        }
        
        /* Review Screen */
        .review-container {
            padding: 20px;
        }
        
        .review-question {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }
        
        .review-status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .review-status.correct {
            background: #d1fae5;
            color: #065f46;
        }
        
        .review-status.incorrect {
            background: #fee2e2;
            color: #991b1b;
        }
        
        .explanation {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }
        
        .explanation-image {
            max-width: 100%;
            max-height: 150px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .review-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }
        
        /* Submit Confirmation Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        .modal-title {
            color: #1e293b;
            font-size: 24px;
            margin-bottom: 15px;
        }
        
        .modal-message {
            color: #64748b;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
        }
        
        .modal-btn.primary {
            background: #3b82f6;
            color: white;
        }
        
        .modal-btn.primary:hover {
            background: #2563eb;
        }
        
        .modal-btn.secondary {
            background: #e2e8f0;
            color: #475569;
        }
        
        .modal-btn.secondary:hover {
            background: #cbd5e1;
        }
        
        /* NEET Countdown Styles */
        .neet-countdown-card {
            animation: pulse 2s infinite;
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            border: 2px solid #fbbf24;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(251, 191, 36, 0); }
            100% { box-shadow: 0 0 0 0 rgba(251, 191, 36, 0); }
        }

        .countdown-unit {
            text-align: center;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }

        .countdown-unit:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .countdown-value {
            font-size: 32px;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            line-height: 1;
        }

        .countdown-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: rgba(255,255,255,0.9);
            margin-top: 5px;
        }

        .countdown-critical .countdown-value {
            color: #ef4444;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #neetCountdown {
            transition: all 0.3s ease;
        }

        #neetCountdown:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                max-width: 100%;
                margin: 10px;
            }
            
            .auth-container {
                padding: 25px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .week-grid {
                grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            }
            
            .week-cell {
                height: 50px;
                font-size: 12px;
            }
            
            .test-interface {
                max-width: 100%;
            }
            
            .result-stats {
                grid-template-columns: 1fr;
            }
            
            .modal-buttons {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
            
            .countdown-value {
                font-size: 24px;
            }
            
            .countdown-unit {
                padding: 8px;
            }
            
            #neetCountdown {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            #countdownTimer {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
            
            .dashboard-tab {
                padding: 12px 15px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Auth Screens -->
    <div id="authScreen" class="container">
        <div class="auth-container">
            <div class="auth-header">
                <div class="auth-icon">üéì</div>
                <h1 class="auth-title">NEET Preparation Portal</h1>
                <p class="auth-subtitle">10 Weeks ‚Ä¢ 180 Questions Weekly ‚Ä¢ Track Your Progress</p>
            </div>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="showAuthTab('login')">Login</div>
                <div class="auth-tab" onclick="showAuthTab('register')">Register</div>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="loginUsername" class="form-input" placeholder="Enter your username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Enter your password">
                </div>
                
                <button onclick="loginUser()" class="auth-btn">üîê Login to Dashboard</button>
            </div>
            
            <!-- Register Form -->
            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="regFullName" class="form-input" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" id="regUsername" class="form-input" placeholder="Choose a username">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" id="regPassword" class="form-input" placeholder="Choose a password (min 6 chars)">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Confirm Password</label>
                    <input type="password" id="regConfirmPassword" class="form-input" placeholder="Confirm your password">
                </div>
                
                <button onclick="registerUser()" class="auth-btn">üöÄ Create Account</button>
            </div>
            
            <div style="margin-top: 20px; text-align: center; color: #64748b; font-size: 14px;">
                <p>Track your 10-week journey with detailed analytics and certificates</p>
            </div>
        </div>
    </div>
    
    <!-- Dashboard -->
    <div id="dashboard" class="container" style="display: none;">
        <button onclick="logoutUser()" class="logout-btn">üëã Logout</button>
        
        <div class="dashboard-header">
            <div class="welcome-message" id="welcomeMessage">Welcome, Student!</div>
            <div class="student-id" id="studentId">ID: Loading...</div>
            
            <!-- NEET Countdown Timer -->
            <div id="neetCountdown" style="
                background: rgba(255,255,255,0.15);
                padding: 8px 20px;
                border-radius: 20px;
                font-size: 14px;
                margin-top: 15px;
                display: inline-block;
                font-weight: 500;
                backdrop-filter: blur(10px);">

                <span style="margin-right: 10px;">‚è≥</span>
                <span id="countdownText">NEET 2026: Loading...</span>
            </div>
        </div>
        
        <div class="dashboard-tabs">
            <div class="dashboard-tab active" onclick="showDashboardTab('progress')">
                üìä Progress
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('tests')">
                üìù Take Test
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('history')">
                üìà History
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('certificate')">
                üèÜ Certificate
            </div>
            <div class="dashboard-tab" onclick="showDashboardTab('profile')">
                üë§ Profile
            </div>
        </div>
        
        <!-- Progress Tab -->
        <div id="progressTab" class="dashboard-content">
            <div class="progress-circle">
                <svg class="progress-ring" width="150" height="150">
                    <circle class="progress-ring-bg" cx="75" cy="75" r="65" stroke-width="8"></circle>
                    <circle class="progress-ring-fill" cx="75" cy="75" r="65" stroke-width="8"></circle>
                </svg>
                <div class="progress-text">
                    <div class="progress-percent" id="progressPercent">0%</div>
                    <div class="progress-label">Overall Progress</div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="completedWeeks">0</div>
                    <div class="stat-label">Weeks Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgScore">0%</div>
                    <div class="stat-label">Avg Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">Tests Taken</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalQuestions">0</div>
                    <div class="stat-label">Qns Attempted</div>
                </div>
            </div>

            <!-- NEET Countdown Card -->
            <div class="neet-countdown-card">
                <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;">
                    <div style="font-size: 24px;">‚è∞</div>
                    <h3 style="color: white; margin: 0;">NEET 2026 Countdown</h3>
                </div>
                
                <div id="countdownTimer" style="
                    display: grid;
                    grid-template-columns: repeat(4, 1fr);
                    gap: 15px;
                    margin: 20px 0;
                ">
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-days">00</div>
                        <div class="countdown-label">Days</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-hours">00</div>
                        <div class="countdown-label">Hours</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-minutes">00</div>
                        <div class="countdown-label">Minutes</div>
                    </div>
                    <div class="countdown-unit">
                        <div class="countdown-value" id="countdown-seconds">00</div>
                        <div class="countdown-label">Seconds</div>
                    </div>
                </div>
                
                <div id="motivationMessage" style="
                    font-size: 16px;
                    font-weight: 600;
                    margin-top: 15px;
                    padding: 10px;
                    background: rgba(255,255,255,0.15);
                    border-radius: 8px;
                    border-left: 4px solid #fbbf24;
                ">
                    Loading motivation message...
                </div>
                
                <div style="
                    background: rgba(255,255,255,0.2);
                    padding: 10px;
                    border-radius: 8px;
                    font-size: 14px;
                    margin-top: 15px;
                ">
                    <span style="font-weight: bold;">üìÖ Exam Date:</span> May 3, 2026 (Sunday)
                </div>
            </div>
            
            <div class="week-progress">
                <h3 class="week-progress-title">10-Week Progress (180 Questions Each)</h3>
                <div class="week-grid" id="weekProgressGrid">
                    <!-- Weeks will be populated -->
                </div>
            </div>
        </div>
        
        <!-- Tests Tab -->
        <div id="testsTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Select Week for Test</h2>
            <p style="color: #64748b; margin-bottom: 25px;">Each test has 180 questions with 3-hour time limit</p>
            
            <div class="week-grid" id="testWeekSelector">
                <!-- Weeks will be populated -->
            </div>
        </div>
        
        <!-- History Tab -->
        <div id="historyTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 20px;">Test History</h2>
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Week</th>
                        <th>Topic</th>
                        <th>Date</th>
                        <th>Score</th>
                        <th>%</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="historyBody">
                    <!-- History will be populated -->
                </tbody>
            </table>
        </div>
        
        <!-- Certificate Tab -->
        <div id="certificateTab" class="dashboard-content" style="display: none;">
            <div id="certificateDisplay">
                <h2 style="color: #1e293b; margin-bottom: 20px;">Your Certificate</h2>
                <div id="certificateContent" style="display: none;">
                    <!-- Certificate will be displayed here -->
                </div>
                <div id="noCertificate" style="padding: 40px; color: #6b7280; text-align: center;">
                    <p style="font-size: 18px; margin-bottom: 20px;">Complete all 10 weeks to unlock your certificate!</p>
                    <div class="progress-circle" style="width: 120px; height: 120px; margin: 20px auto;">
                        <svg class="progress-ring" width="120" height="120">
                            <circle class="progress-ring-bg" cx="60" cy="60" r="52" stroke-width="8"></circle>
                            <circle class="progress-ring-fill" id="certProgressRing" cx="60" cy="60" r="52" stroke-width="8"></circle>
                        </svg>
                        <div class="progress-text">
                            <div class="progress-percent" id="certProgressPercent">0%</div>
                        </div>
                    </div>
                    <p id="weeksRemaining">10 weeks remaining</p>
                </div>
                
                <div id="progressCertificate" style="display: none; margin-top: 30px;">
                    <div class="certificate-preview">
                        <h3 class="certificate-title">Progress Certificate</h3>
                        <p>You have completed <strong id="progressWeeks">0</strong> out of 10 weeks</p>
                        <p>Keep going! You're making great progress!</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Tab -->
        <div id="profileTab" class="dashboard-content" style="display: none;">
            <h2 style="color: #1e293b; margin-bottom: 25px;">Your Profile</h2>
            
            <div style="background: #f8fafc; padding: 25px; border-radius: 10px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Full Name</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileName">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Username</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileUsername">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Student ID</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileId">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Joined Date</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileJoined">Loading...</p>
                    </div>
                    
                    <div>
                        <label style="color: #64748b; font-size: 14px;">Current Week</label>
                        <p style="color: #1e293b; font-size: 18px; font-weight: 600;" id="profileCurrentWeek">Week 1</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                    <h3 style="color: #1e293b; margin-bottom: 15px;">Account Security</h3>
                    <button onclick="changePassword()" style="padding: 12px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer; width: 100%;">
                        üîê Change Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Interface -->
    <div id="testInterface" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2 id="testWeekTitle">Week 1 Test</h2>
            <p id="testTopic">Full Syllabus</p>
        </div>
        
        <div class="timer" id="testTimer">180:00</div>
        
        <div class="question-container">
            <div class="test-info" id="testWeekInfo">
                <!-- Test week info will be populated here -->
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="testProgressBar" style="width: 0%"></div>
            </div>
            
            <div id="questionDisplay">
                <!-- Questions will be loaded here -->
            </div>
            
            <div class="test-controls">
                <button id="prevBtn" class="test-btn" onclick="prevQuestion()" disabled>‚¨Ö Previous</button>
                <div>
                    <span id="questionCounter">Question 1/180</span>
                </div>
                <button id="nextBtn" class="test-btn" onclick="nextQuestion()">Next ‚û°</button>
                <button id="submitBtn" class="test-btn submit" onclick="showSubmitConfirmation()" style="display: none;">Submit Test</button>
            </div>
        </div>
    </div>

    <!-- Result Screen -->
    <div id="resultScreen" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2>Test Results</h2>
            <p>Week <span id="resultWeek">1</span></p>
        </div>
        
        <div class="question-container">
            <div class="result-container">
                <div class="result-icon pass" id="resultIcon">üéØ</div>
                <div class="result-score" id="finalScore">0/180</div>
                <div class="result-message" id="resultMessage"></div>
                
                <div class="result-details">
                    <h3 style="color: #1e293b; margin-bottom: 20px;">Performance Summary</h3>
                    <div class="result-stats">
                        <div class="result-stat">
                            <div class="result-stat-value" id="correctAnswers">0</div>
                            <div class="result-stat-label">Correct</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="wrongAnswers">0</div>
                            <div class="result-stat-label">Wrong</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="percentageScore">0%</div>
                            <div class="result-stat-label">Percentage</div>
                        </div>
                        <div class="result-stat">
                            <div class="result-stat-value" id="timeTaken">0:00</div>
                            <div class="result-stat-label">Time Taken</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px; flex-wrap: wrap;">
                    <button onclick="backToDashboard()" class="test-btn">üìä Dashboard</button>
                    <button onclick="showReviewScreen()" class="test-btn warning">üìù Review</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Screen -->
    <div id="reviewScreen" class="test-interface" style="display: none;">
        <div class="test-header">
            <h2>Test Review</h2>
            <p>Week <span id="reviewWeek">1</span></p>
        </div>
        
        <div class="question-container">
            <div class="review-container">
                <h3 style="color: #1e293b; margin-bottom: 20px;">Review Your Answers</h3>
                <div id="reviewQuestions">
                    <!-- Review questions will be populated here -->
                </div>
                
                <div class="review-controls">
                    <button onclick="backToResults()" class="test-btn">‚¨Ö Back</button>
                    <button onclick="backToDashboard()" class="test-btn">üìä Dashboard</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Confirmation Modal -->
    <div id="submitModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-title">Submit Test?</div>
            <div class="modal-message">
                Are you sure you want to submit?<br>
                You have answered <span id="answeredCount">0</span> out of 180 questions.<br>
                Once submitted, you cannot change your answers.
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" onclick="hideSubmitModal()">Cancel</button>
                <button class="modal-btn primary" onclick="submitTest()">Submit</button>
            </div>
        </div>
    </div>

    <!-- ========== ALL JAVASCRIPT ========== -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // ========== FIREBASE CONFIG ==========
        const firebaseConfig = {
            apiKey: "AIzaSyDQllntvhYYX2_SgZh7eUna1ZCl1_Pk5iE",
            authDomain: "neet-practise-4x.firebaseapp.com",
            databaseURL: "https://neet-practise-4x-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "neet-practise-4x",
            storageBucket: "neet-practise-4x.firebasestorage.app",
            messagingSenderId: "580564387981",
            appId: "1:580564387981:web:14bca0642e18e2b568bac4"
        };
        
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // ========== GLOBAL VARIABLES ==========
        let currentUser = null;
        let userId = null;
        
        // 10-Week Schedule
        const weekSchedule = [
            {week: 1, topic: "Physics: Mechanics + Heat", subject: "Physics"},
            {week: 2, topic: "Physics: Electricity + Magnetism", subject: "Physics"},
            {week: 3, topic: "Physics: Optics + Modern Physics", subject: "Physics"},
            {week: 4, topic: "Chemistry: Physical + Inorganic", subject: "Chemistry"},
            {week: 5, topic: "Chemistry: Organic + NCERT", subject: "Chemistry"},
            {week: 6, topic: "Biology: Botany", subject: "Biology"},
            {week: 7, topic: "Biology: Zoology", subject: "Biology"},
            {week: 8, topic: "Full Syllabus Mock Test 1", subject: "Mixed"},
            {week: 9, topic: "Full Syllabus Mock Test 2", subject: "Mixed"},
            {week: 10, topic: "Final Revision + Mega Mock", subject: "Mixed"}
        ];
        
        // Test Variables
        let currentTestWeek = 0;
        let testQuestions = [];
        let currentQuestionIndex = 0;
        let testTimer = null;
        let timeRemaining = 180 * 60; // 3 hours in seconds
        let userAnswers = {};
        let testStartTime = null;
        let testEndTime = null;
        let testResults = null;
        
        // ========== AUTHENTICATION ==========
        function showAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'none';
            
            if (tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('loginForm').style.display = 'block';
            } else {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('registerForm').style.display = 'block';
            }
        }
        
        function registerUser() {
            const fullName = document.getElementById('regFullName').value.trim();
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;
            
            if (!fullName || !username || !password) {
                alert('Please fill all fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            if (password !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        alert('Username already exists. Please choose another.');
                        return;
                    }
                    
                    userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    const userData = {
                        fullName: fullName,
                        username: username,
                        password: password,
                        createdAt: new Date().toISOString(),
                        lastActive: new Date().toISOString(),
                        currentWeek: 1,
                        completedWeeks: [],
                        scores: {}
                    };
                    
                    database.ref('users/' + userId).set(userData)
                        .then(() => {
                            alert('‚úÖ Registration successful! Please login.');
                            showAuthTab('login');
                            document.getElementById('loginUsername').value = username;
                            document.getElementById('loginPassword').value = '';
                            
                            document.getElementById('regFullName').value = '';
                            document.getElementById('regUsername').value = '';
                            document.getElementById('regPassword').value = '';
                            document.getElementById('regConfirmPassword').value = '';
                        })
                        .catch(error => {
                            alert('Registration failed: ' + error.message);
                        });
                });
        }
        
        function loginUser() {
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('Please enter username and password');
                return;
            }
            
            database.ref('users').orderByChild('username').equalTo(username).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        alert('Username not found');
                        return;
                    }
                    
                    const users = snapshot.val();
                    let foundUser = null;
                    let foundUserId = null;
                    
                    Object.entries(users).forEach(([id, user]) => {
                        if (user.password === password) {
                            foundUser = user;
                            foundUserId = id;
                        }
                    });
                    
                    if (!foundUser) {
                        alert('Incorrect password');
                        return;
                    }
                    
                    currentUser = foundUser;
                    userId = foundUserId;
                    
                    database.ref('users/' + userId + '/lastActive').set(new Date().toISOString());
                    
                    document.getElementById('authScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    
                    updateDashboard();
                    
                    localStorage.setItem('neetUserId', userId);
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                })
                .catch(error => {
                    alert('Login failed: ' + error.message);
                });
        }
        
        function logoutUser() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                userId = null;
                localStorage.removeItem('neetUserId');
                localStorage.removeItem('neetUserData');
                
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('authScreen').style.display = 'flex';
                
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                showAuthTab('login');
            }
        }
        
        function changePassword() {
            const newPassword = prompt('Enter new password (min 6 characters):');
            if (!newPassword || newPassword.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }
            
            const confirmPassword = prompt('Confirm new password:');
            if (newPassword !== confirmPassword) {
                alert('Passwords do not match');
                return;
            }
            
            database.ref('users/' + userId + '/password').set(newPassword)
                .then(() => {
                    alert('‚úÖ Password changed successfully!');
                    currentUser.password = newPassword;
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                })
                .catch(error => {
                    alert('Error changing password: ' + error.message);
                });
        }
        
        // ========== NEET COUNTDOWN TIMER ==========
        function startNEETCountdown() {
            const neetExamDate = new Date('May 3, 2026 10:00:00').getTime();
            
            function updateCountdown() {
                const now = new Date().getTime();
                const timeRemaining = neetExamDate - now;
                
                if (timeRemaining < 0) {
                    document.getElementById('countdownText').innerHTML = '<span style="color: #10b981;">üéâ NEET 2026 Completed!</span>';
                    document.getElementById('countdownTimer').innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">üéä</div>
                            <h3 style="color: white; margin: 0; font-size: 24px;">Congratulations!</h3>
                            <p style="opacity: 0.9; margin-top: 10px;">NEET 2026 has been completed.</p>
                        </div>
                    `;
                    return;
                }
                
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);
                
                document.getElementById('countdownText').textContent = `NEET 2026: ${days}d ${hours}h ${minutes}m ${seconds}s`;
                document.getElementById('countdown-days').textContent = days.toString().padStart(2, '0');
                document.getElementById('countdown-hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('countdown-minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('countdown-seconds').textContent = seconds.toString().padStart(2, '0');
                
                updateMotivationMessage(days);
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }
        
        function updateMotivationMessage(days) {
            const messages = [
                { threshold: 0, message: "Exam day! Give your best! üí™" },
                { threshold: 7, message: "Final week! Intensive revision! üìö" },
                { threshold: 30, message: "One month to go! Stay consistent! ‚è≥" },
                { threshold: 60, message: "Two months remaining! Keep pushing! üî•" }
            ];
            
            let currentMessage = "Your NEET journey continues! Stay dedicated! üéì";
            
            for (const msg of messages) {
                if (days <= msg.threshold) {
                    currentMessage = msg.message;
                    break;
                }
            }
            
            const motivationEl = document.getElementById('motivationMessage');
            if (motivationEl) motivationEl.innerHTML = currentMessage;
        }
        
        // ========== DASHBOARD FUNCTIONS ==========
        function updateDashboard() {
            if (!currentUser || !userId) return;
            
            startNEETCountdown();
            
            document.getElementById('welcomeMessage').textContent = `Welcome, ${currentUser.fullName || currentUser.username}!`;
            document.getElementById('studentId').textContent = `ID: ${userId.substring(0, 8)}`;
            
            document.getElementById('profileName').textContent = currentUser.fullName || 'N/A';
            document.getElementById('profileUsername').textContent = currentUser.username;
            document.getElementById('profileId').textContent = userId.substring(0, 8);
            document.getElementById('profileJoined').textContent = new Date(currentUser.createdAt).toLocaleDateString();
            document.getElementById('profileCurrentWeek').textContent = `Week ${currentUser.currentWeek || 1}`;
            
            const completedWeeks = currentUser.completedWeeks || [];
            const totalWeeks = 10;
            const progressPercent = Math.round((completedWeeks.length / totalWeeks) * 100);
            
            const circle = document.querySelector('.progress-ring-fill');
            const radius = 65;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (progressPercent / 100) * circumference;
            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = offset;
            
            document.getElementById('progressPercent').textContent = `${progressPercent}%`;
            document.getElementById('completedWeeks').textContent = completedWeeks.length;
            
            let totalScore = 0;
            let totalTests = 0;
            let totalQuestionsAttempted = 0;
            
            if (currentUser.scores) {
                Object.values(currentUser.scores).forEach(score => {
                    totalScore += (score.score / score.total) * 100;
                    totalTests++;
                    totalQuestionsAttempted += score.total;
                });
            }
            
            const avgScore = totalTests > 0 ? Math.round(totalScore / totalTests) : 0;
            document.getElementById('avgScore').textContent = `${avgScore}%`;
            document.getElementById('totalTests').textContent = totalTests;
            document.getElementById('totalQuestions').textContent = totalQuestionsAttempted;
            
            updateWeekProgressGrid(completedWeeks, currentUser.currentWeek);
            updateTestWeekSelector(completedWeeks, currentUser.currentWeek);
            updateHistoryTable(currentUser.scores || {});
            updateCertificateProgress(completedWeeks.length);
        }
        
        function updateWeekProgressGrid(completedWeeks, currentWeek) {
            const grid = document.getElementById('weekProgressGrid');
            grid.innerHTML = '';
            
            for (let week = 1; week <= 10; week++) {
                const weekCell = document.createElement('div');
                weekCell.className = 'week-cell';
                
                if (completedWeeks.includes(week)) {
                    weekCell.className = 'week-cell completed';
                } else if (week === currentWeek) {
                    weekCell.className = 'week-cell current';
                } else if (week < currentWeek) {
                    weekCell.className = 'week-cell available';
                } else {
                    weekCell.className = 'week-cell locked';
                }
                
                weekCell.innerHTML = `
                    <div class="week-number">W${week}</div>
                    <div class="week-questions">180 Q</div>
                `;
                
                weekCell.onclick = () => {
                    if (weekCell.classList.contains('locked')) return;
                    if (completedWeeks.includes(week)) {
                        if (confirm(`Week ${week} already completed. Retake?`)) {
                            startTest(week);
                        }
                    } else {
                        startTest(week);
                    }
                };
                
                grid.appendChild(weekCell);
            }
        }
        
        function updateTestWeekSelector(completedWeeks, currentWeek) {
            const selector = document.getElementById('testWeekSelector');
            selector.innerHTML = '';
            
            for (let week = 1; week <= 10; week++) {
                const weekCell = document.createElement('div');
                weekCell.className = 'week-cell';
                
                if (week <= currentWeek) {
                    weekCell.className = 'week-cell available';
                } else {
                    weekCell.className = 'week-cell locked';
                }
                
                weekCell.innerHTML = `
                    <div class="week-number">W${week}</div>
                    <div class="week-questions">180 Q</div>
                `;
                
                weekCell.onclick = () => {
                    if (!weekCell.classList.contains('locked')) {
                        startTest(week);
                    }
                };
                
                selector.appendChild(weekCell);
            }
        }
        
        function updateHistoryTable(scores) {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            
            if (Object.keys(scores).length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 40px; color: #64748b;">
                            No tests taken yet. Start your first test!
                        </td>
                    </tr>
                `;
                return;
            }
            
            Object.entries(scores).forEach(([weekKey, score]) => {
                const weekNum = parseInt(weekKey.replace('week', ''));
                const weekInfo = weekSchedule[weekNum - 1] || {topic: `Week ${weekNum}`};
                
                const percentage = Math.round((score.score / score.total) * 100);
                const date = new Date(score.dateCompleted);
                const formattedDate = date.toLocaleDateString();
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>Week ${weekNum}</td>
                    <td>${weekInfo.topic}</td>
                    <td>${formattedDate}</td>
                    <td>${score.score}/${score.total}</td>
                    <td style="color: ${percentage >= 70 ? '#10b981' : percentage >= 50 ? '#f59e0b' : '#ef4444'}; font-weight: bold;">
                        ${percentage}%
                    </td>
                    <td>
                        <button onclick="reviewTestFromHistory(${weekNum})" style="padding: 6px 12px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px;">
                            Review
                        </button>
                    </td>
                `;
            });
        }
        
        function reviewTestFromHistory(week) {
            const scoreKey = `week${week}`;
            if (currentUser.scores && currentUser.scores[scoreKey]) {
                const testData = currentUser.scores[scoreKey];
                showReviewForCompletedTest(week, testData);
            } else {
                alert('No test data found for this week.');
            }
        }
        
        function updateCertificateProgress(completedWeeks) {
            const totalWeeks = 10;
            const progressPercent = Math.round((completedWeeks / totalWeeks) * 100);
            const weeksRemaining = totalWeeks - completedWeeks;
            
            const circle = document.getElementById('certProgressRing');
            if (circle) {
                const radius = 52;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (progressPercent / 100) * circumference;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = offset;
                
                document.getElementById('certProgressPercent').textContent = `${progressPercent}%`;
                document.getElementById('weeksRemaining').textContent = `${weeksRemaining} weeks remaining`;
                
                if (completedWeeks > 0 && completedWeeks < 10) {
                    document.getElementById('progressCertificate').style.display = 'block';
                    document.getElementById('progressWeeks').textContent = completedWeeks;
                    document.getElementById('noCertificate').style.display = 'none';
                } else if (completedWeeks >= 10) {
                    showFullCertificate();
                }
            }
        }
        
        function showFullCertificate() {
            document.getElementById('noCertificate').style.display = 'none';
            document.getElementById('progressCertificate').style.display = 'none';
            
            const certContent = document.getElementById('certificateContent');
            certContent.style.display = 'block';
            certContent.innerHTML = `
                <div class="certificate-preview">
                    <h1 class="certificate-title">Certificate of Completion</h1>
                    <p style="color: #4b5563; font-size: 18px;">This certifies that</p>
                    <h2 class="certificate-name">${currentUser.fullName || currentUser.username}</h2>
                    <p style="color: #6b7280; font-size: 16px; line-height: 1.6; margin: 20px 0;">
                        has successfully completed the 10-week NEET preparation program<br>
                        with 180 questions per week
                    </p>
                    
                    <div style="display: flex; gap: 15px; justify-content: center; margin-top: 30px;">
                        <button onclick="downloadMyCertificate()" style="padding: 12px 25px; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üì• Download
                        </button>
                        <button onclick="printMyCertificate()" style="padding: 12px 25px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            üñ®Ô∏è Print
                        </button>
                    </div>
                </div>
            `;
        }
        
        function downloadMyCertificate() {
            const certContent = `
                <html>
                <head><title>NEET Certificate</title>
                <style>body{font-family:Arial;padding:40px;text-align:center}
                .certificate{border:3px solid gold;padding:40px;margin:20px auto;max-width:800px}
                .title{color:#1e3a8a;font-size:32px}.name{color:#3730a3;font-size:36px}</style></head>
                <body><div class="certificate">
                    <h1 class="title">Certificate of Completion</h1>
                    <p>This certifies that</p>
                    <h2 class="name">${currentUser.fullName || currentUser.username}</h2>
                    <p>has completed the 10-week NEET preparation program</p>
                    <p>Student ID: ${userId.substring(0, 8)}</p>
                    <p>Date: ${new Date().toLocaleDateString()}</p>
                </div></body></html>
            `;
            
            const blob = new Blob([certContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `NEET_Certificate_${currentUser.username}.html`;
            a.click();
        }
        
        function printMyCertificate() {
            window.print();
        }
        
        function showDashboardTab(tabName) {
            document.querySelectorAll('.dashboard-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + 'Tab').style.display = 'block';
            event.currentTarget.classList.add('active');
        }
        
        // ========== TEST FUNCTIONS ==========
        function startTest(week) {
            currentTestWeek = week;
            currentQuestionIndex = 0;
            timeRemaining = 180 * 60; // 3 hours
            userAnswers = {};
            testStartTime = new Date();
            
            const weekInfo = weekSchedule[week - 1] || {topic: `Week ${week}`, subject: "General"};
            
            document.getElementById('testWeekTitle').textContent = `Week ${week} Test`;
            document.getElementById('testTopic').textContent = weekInfo.topic;
            
            document.getElementById('testWeekInfo').innerHTML = `
                <div>
                    <h3 style="color:#1e293b;margin:0 0 5px">${weekInfo.topic}</h3>
                    <p style="color:#64748b;margin:0">${weekInfo.subject} ‚Ä¢ 180 Questions ‚Ä¢ 3 Hours</p>
                </div>
            `;
            
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'none';
            document.getElementById('testInterface').style.display = 'block';
            
            loadQuestionsFromFirebase(week);
        }
        
        // ========== IMAGE SUPPORTED QUESTION LOADING ==========
        function loadQuestionsFromFirebase(week) {
            console.log(`Loading questions for Week ${week}...`);
            
            database.ref(`questions/week${week}`).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const questionsData = snapshot.val();
                        console.log('Raw data:', questionsData);
                        
                        testQuestions = [];
                        
                        // Check if data has questions array
                        if (questionsData.questions && Array.isArray(questionsData.questions)) {
                            questionsData.questions.forEach((q, index) => {
                                const optionsArray = [];
                                
                                // Handle options with images
                                if (q.options) {
                                    Object.entries(q.options).forEach(([key, value]) => {
                                        if (typeof value === 'object' && value !== null) {
                                            // New format: {text: "...", image: "..."}
                                            optionsArray.push({
                                                id: key,
                                                text: value.text || `Option ${key}`,
                                                image: value.image || null
                                            });
                                        } else {
                                            // Old format: just text
                                            optionsArray.push({
                                                id: key,
                                                text: value,
                                                image: null
                                            });
                                        }
                                    });
                                }
                                
                                testQuestions.push({
                                    id: q.id || index + 1,
                                    text: q.question || `Question ${index + 1}`,
                                    image: q.questionImage || null,
                                    options: optionsArray,
                                    correctAnswer: q.answer || 'A',
                                    explanation: q.explanation || 'No explanation',
                                    explanationImage: q.explanationImage || null
                                });
                            });
                        } else {
                            // Alternative structure - direct question objects
                            Object.entries(questionsData).forEach(([key, q]) => {
                                if (q && q.question) {
                                    const optionsArray = [];
                                    
                                    if (q.options) {
                                        Object.entries(q.options).forEach(([optKey, optValue]) => {
                                            if (typeof optValue === 'object') {
                                                optionsArray.push({
                                                    id: optKey,
                                                    text: optValue.text || `Option ${optKey}`,
                                                    image: optValue.image || null
                                                });
                                            } else {
                                                optionsArray.push({
                                                    id: optKey,
                                                    text: optValue,
                                                    image: null
                                                });
                                            }
                                        });
                                    }
                                    
                                    testQuestions.push({
                                        id: q.id || key,
                                        text: q.question,
                                        image: q.questionImage || null,
                                        options: optionsArray,
                                        correctAnswer: q.answer || 'A',
                                        explanation: q.explanation || 'No explanation',
                                        explanationImage: q.explanationImage || null
                                    });
                                }
                            });
                        }
                        
                        console.log(`Loaded ${testQuestions.length} questions with images`);
                        
                        if (testQuestions.length === 0) {
                            alert(`No questions for Week ${week}. Contact admin.`);
                            backToDashboard();
                            return;
                        }
                        
                        loadQuestion();
                        startTestTimer();
                        
                    } else {
                        alert(`No questions for Week ${week}. Contact admin.`);
                        backToDashboard();
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error loading questions');
                    backToDashboard();
                });
        }
        
        function loadQuestion() {
            if (testQuestions.length === 0) return;
            
            const question = testQuestions[currentQuestionIndex];
            const questionDisplay = document.getElementById('questionDisplay');
            
            const progressPercent = ((currentQuestionIndex + 1) / testQuestions.length) * 100;
            document.getElementById('testProgressBar').style.width = `${progressPercent}%`;
            document.getElementById('questionCounter').textContent = 
                `Question ${currentQuestionIndex + 1}/${testQuestions.length}`;
            
            let optionsHTML = '';
            question.options.forEach(option => {
                const isSelected = userAnswers[question.id] === option.id;
                const imageHtml = option.image ? `<img src="${option.image}" class="option-image" alt="">` : '';
                
                optionsHTML += `
                    <div class="option ${isSelected ? 'selected' : ''}" onclick="selectOption('${option.id}')">
                        <div class="option-label">${option.id}</div>
                        <div class="option-content">
                            <span>${option.text}</span>
                            ${imageHtml}
                        </div>
                    </div>
                `;
            });
            
            const questionImageHtml = question.image ? 
                `<img src="${question.image}" class="question-image" alt="Question Image">` : '';
            
            questionDisplay.innerHTML = `
                <div class="question">
                    <div class="question-text">${question.text}</div>
                    ${questionImageHtml}
                    <div class="options">${optionsHTML}</div>
                </div>
            `;
            
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            
            if (currentQuestionIndex === testQuestions.length - 1) {
                document.getElementById('nextBtn').style.display = 'none';
                document.getElementById('submitBtn').style.display = 'inline-block';
            } else {
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('submitBtn').style.display = 'none';
            }
        }
        
        function selectOption(optionId) {
            const question = testQuestions[currentQuestionIndex];
            userAnswers[question.id] = optionId;
            loadQuestion();
        }
        
        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < testQuestions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }
        
        function showSubmitConfirmation() {
            const answeredCount = Object.keys(userAnswers).length;
            document.getElementById('answeredCount').textContent = answeredCount;
            document.getElementById('submitModal').style.display = 'flex';
        }
        
        function hideSubmitModal() {
            document.getElementById('submitModal').style.display = 'none';
        }
        
        function startTestTimer() {
            updateTimerDisplay();
            testTimer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                
                if (timeRemaining <= 0) {
                    clearInterval(testTimer);
                    submitTest();
                }
            }, 1000);
        }
        
        function updateTimerDisplay() {
            const hours = Math.floor(timeRemaining / 3600);
            const minutes = Math.floor((timeRemaining % 3600) / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('testTimer').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeRemaining <= 300) {
                document.getElementById('testTimer').style.background = '#dc2626';
            }
        }
        
        function submitTest() {
            clearInterval(testTimer);
            hideSubmitModal();
            testEndTime = new Date();
            
            let correct = 0;
            testQuestions.forEach(question => {
                if (userAnswers[question.id] === question.correctAnswer) {
                    correct++;
                }
            });
            
            const totalQuestions = testQuestions.length;
            const percentage = Math.round((correct / totalQuestions) * 100);
            const timeTaken = Math.floor((testEndTime - testStartTime) / 1000);
            
            testResults = {
                week: currentTestWeek,
                score: correct,
                total: totalQuestions,
                percentage: percentage,
                timeTaken: timeTaken,
                answers: userAnswers,
                questions: testQuestions,
                dateCompleted: new Date().toISOString()
            };
            
            saveTestResults(testResults);
            showTestResults();
        }
        
        function saveTestResults(results) {
            const scoreData = {
                score: results.score,
                total: results.total,
                percentage: results.percentage,
                dateCompleted: results.dateCompleted,
                timeTaken: results.timeTaken,
                answers: results.answers
            };
            
            const userRef = database.ref('users/' + userId);
            userRef.once('value').then(snapshot => {
                const userData = snapshot.val();
                
                const completedWeeks = userData.completedWeeks || [];
                if (!completedWeeks.includes(currentTestWeek)) {
                    completedWeeks.push(currentTestWeek);
                    userData.completedWeeks = completedWeeks.sort((a,b) => a - b);
                    
                    if (currentTestWeek === userData.currentWeek) {
                        userData.currentWeek = Math.min(currentTestWeek + 1, 10);
                    }
                }
                
                userData.scores = userData.scores || {};
                userData.scores[`week${currentTestWeek}`] = scoreData;
                
                userRef.set(userData).then(() => {
                    currentUser = userData;
                    localStorage.setItem('neetUserData', JSON.stringify(currentUser));
                });
            });
        }
        
        function showTestResults() {
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
            
            document.getElementById('resultWeek').textContent = currentTestWeek;
            document.getElementById('finalScore').textContent = `${testResults.score}/${testResults.total}`;
            document.getElementById('correctAnswers').textContent = testResults.score;
            document.getElementById('wrongAnswers').textContent = testResults.total - testResults.score;
            document.getElementById('percentageScore').textContent = `${testResults.percentage}%`;
            
            const hours = Math.floor(testResults.timeTaken / 3600);
            const minutes = Math.floor((testResults.timeTaken % 3600) / 60);
            const seconds = testResults.timeTaken % 60;
            document.getElementById('timeTaken').textContent = 
                `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const resultIcon = document.getElementById('resultIcon');
            const resultMessage = document.getElementById('resultMessage');
            
            if (testResults.percentage >= 70) {
                resultIcon.textContent = 'üéâ';
                resultMessage.textContent = 'Excellent! You aced this test!';
            } else if (testResults.percentage >= 50) {
                resultIcon.textContent = 'üëç';
                resultMessage.textContent = 'Good job! Keep practicing.';
            } else {
                resultIcon.textContent = 'üìö';
                resultMessage.textContent = 'Need more practice. Try again!';
            }
        }
        
        function showReviewScreen() {
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'block';
            
            document.getElementById('reviewWeek').textContent = currentTestWeek;
            
            const reviewContainer = document.getElementById('reviewQuestions');
            reviewContainer.innerHTML = '';
            
            testResults.questions.forEach((question, index) => {
                const userAnswer = testResults.answers[question.id];
                const isCorrect = userAnswer === question.correctAnswer;
                
                let optionsHTML = '';
                question.options.forEach(option => {
                    let optionClass = '';
                    if (option.id === question.correctAnswer) {
                        optionClass = 'correct';
                    } else if (option.id === userAnswer && !isCorrect) {
                        optionClass = 'wrong';
                    } else if (option.id === userAnswer) {
                        optionClass = 'selected';
                    }
                    
                    const imageHtml = option.image ? `<img src="${option.image}" class="option-image">` : '';
                    
                    optionsHTML += `
                        <div class="option ${optionClass}">
                            <div class="option-label">${option.id}</div>
                            <div class="option-content">
                                <span>${option.text}</span>
                                ${imageHtml}
                            </div>
                        </div>
                    `;
                });
                
                const questionImageHtml = question.image ? 
                    `<img src="${question.image}" class="question-image">` : '';
                const explanationImageHtml = question.explanationImage ? 
                    `<img src="${question.explanationImage}" class="explanation-image">` : '';
                
                const reviewHTML = `
                    <div class="review-question">
                        <div class="review-status ${isCorrect ? 'correct' : 'incorrect'}">
                            ${isCorrect ? '‚úì Correct' : '‚úó Incorrect'}
                        </div>
                        <div class="question-text">${question.text}</div>
                        ${questionImageHtml}
                        <div class="options">${optionsHTML}</div>
                        <div class="explanation">
                            <strong>Explanation:</strong> ${question.explanation}
                            ${explanationImageHtml}
                        </div>
                    </div>
                `;
                
                reviewContainer.innerHTML += reviewHTML;
            });
        }
        
        function showReviewForCompletedTest(week, testData) {
            currentTestWeek = week;
            
            loadQuestionsFromFirebase(week);
            
            setTimeout(() => {
                if (testQuestions.length === 0) {
                    alert('Questions not found.');
                    backToDashboard();
                    return;
                }
                
                testResults = {
                    week: week,
                    score: testData.score,
                    total: testData.total,
                    percentage: testData.percentage,
                    timeTaken: testData.timeTaken,
                    answers: testData.answers,
                    questions: testQuestions,
                    dateCompleted: testData.dateCompleted
                };
                
                showReviewScreen();
            }, 1000);
        }
        
        function backToResults() {
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
        }
        
        function backToDashboard() {
            document.getElementById('testInterface').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            updateDashboard();
            showDashboardTab('progress');
        }
        
        function checkAutoLogin() {
            const savedUserId = localStorage.getItem('neetUserId');
            const savedUserData = localStorage.getItem('neetUserData');
            
            if (savedUserId && savedUserData) {
                database.ref('users/' + savedUserId).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            currentUser = JSON.parse(savedUserData);
                            userId = savedUserId;
                            
                            database.ref('users/' + userId + '/lastActive').set(new Date().toISOString());
                            
                            document.getElementById('authScreen').style.display = 'none';
                            document.getElementById('dashboard').style.display = 'block';
                            updateDashboard();
                        }
                    })
                    .catch(() => {
                        localStorage.removeItem('neetUserId');
                        localStorage.removeItem('neetUserData');
                    });
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            checkAutoLogin();
            showAuthTab('login');
            startNEETCountdown();
        });
    </script>
</body>
</html>
